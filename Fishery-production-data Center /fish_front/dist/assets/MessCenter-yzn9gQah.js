/* empty css            *//* empty css                *//* empty css                *//* empty css               *//* empty css               *//* empty css                 *//* empty css                   *//* empty css              *//* empty css                     *//* empty css               */import{_ as pa,e as t,L as Qe,i as P,f as xa,M as Ee,T as Sa,y as V,o as v,s as u,G as _a,b as h,d as e,N as ma,O as ga,w as aa,c as O,q as ka,u as Va,H as Da,X as rt,Y as Ia,a2 as Ba,A as $a,B as za,Q as Fa,R as Pa,F as q,j as H,a3 as nt,a4 as st,k as De,t as Ve,a5 as ut,x as La,z as Ua,n as Ke,p as Na,l as ca,a6 as it,C as Ya,a7 as ja,P as dt,E as ct,a8 as pt}from"./index-DuqoxwSR.js";import{i as Be}from"./index-DQYQA18e.js";import{a as Re}from"./index-t--hEgTQ.js";/* empty css              *//* empty css             */const vt={class:"drawer-content"},ht={class:"search-filter"},ft={key:0,class:"fishery-detail"},_t={class:"detail-content"},mt={class:"image-section"},gt={class:"info-section"},yt={class:"description-text"},bt={class:"search-filter"},wt={class:"search-filter"},Ct={class:"chart-container"},kt={class:"time-selector"},xt={class:"charts-wrapper"},St={class:"chart-row top-chart"},Vt={class:"chart-row bottom-charts"},Dt={class:"right-chart"},$t={class:"fishery-selector"},Ca=5*60*1e3,zt={__name:"FisheryCenter",props:{modelValue:Boolean},emits:["update:modelValue"],setup(We,{emit:Ne}){const Ae=We,ze=Ne,G=t(!1);Qe(()=>Ae.modelValue,p=>{G.value=p}),Qe(G,p=>{ze("update:modelValue",p),p?Ke(async()=>{try{ae.value=!0,A.value&&(ce=Be(A.value)),_e.value&&(y=Be(_e.value)),n.value&&(s=Be(n.value));const r=Date.now();!R.value||!X.value||r-X.value>=Ca?await K():(we(R.value),re(R.value),Q(R.value))}catch(r){console.error("初始化图表失败:",r),Ee.error("初始化图表失败")}finally{ae.value=!1}}):(ce&&(ce.dispose(),ce=null),y&&(y.dispose(),y=null),s&&(s.dispose(),s=null))});const Ce=t("info"),Fe=t("history"),L=t(1),oe=t(20),te=t(""),ae=t(!1),ee=t(!1),se=t([]),me=t(null),ve=t("");t({dateRange:[],catchType:"",catchFishery:"",catchDock:"",searchQuery:""});const Y=t([]),j=t([]),E=t(1),U=t(20),M=t(1),J=t(20);t([]),t([]),t([]);const A=t(null),_e=t(null);let ce=null,y=null;const m=t("2024"),C=t("12"),D=t(""),ke=t(Array.from({length:10},(p,r)=>({value:(new Date().getFullYear()-r).toString(),label:`${new Date().getFullYear()-r}年`}))),xe=t(Array.from({length:12},(p,r)=>({value:(r+1).toString(),label:`${r+1}月`}))),ye=t(Array.from({length:31},(p,r)=>({value:(r+1).toString(),label:`${r+1}日`}))),$e=t(null),R=t(null),W=t(null),X=t(null),be=t(""),Oe=t(""),Ye=P(()=>{if(!te.value)return se.value;const p=te.value.toLowerCase().trim();return se.value.filter(r=>Object.values(r).some(k=>String(k).toLowerCase().includes(p)))}),Pe=P(()=>{const p=(L.value-1)*oe.value,r=p+oe.value;return Ye.value.slice(p,r)}),Se=()=>{L.value=1,M.value=1},Le=()=>{te.value="",L.value=1,M.value=1},ue=p=>{oe.value=p,L.value=1},ne=p=>{L.value=p},fe=p=>{me.value=p,ve.value=p.fsy_id,b(p.fsy_id)},b=async p=>{try{ae.value=!0;const r=await Re.get(`http://localhost:8080/fishery/detail/${p}`);if(r.data){const k=se.value.findIndex(c=>c.fsy_id===p);k!==-1&&(se.value[k]={...se.value[k],imageUrl:r.data.imageUrl,description:r.data.description})}}catch(r){console.error("获取渔场详情失败:",r),Ee.error("获取渔场详情失败")}finally{ae.value=!1}},g=async()=>{try{ae.value=!0;const p=Date.now();if($e.value&&X.value&&p-X.value<Ca){se.value=$e.value;return}const r=await Re.get("http://localhost:8080/select");se.value=r.data,$e.value=r.data,X.value=p}catch(p){console.error("获取渔场基础数据失败:",p),Ee.error("获取渔场基础数据失败")}finally{ae.value=!1}},N=async()=>{try{ae.value=!0;const p=Date.now();if(R.value&&X.value&&p-X.value<Ca){Y.value=R.value;return}const r=await Re.get("http://localhost:8080/catch");Y.value=r.data||[],R.value=r.data||[],X.value=p}catch(p){console.error("获取捕捞数据失败:",p),Ee.error("获取捕捞数据失败"),Y.value=[]}finally{ae.value=!1}},I=async()=>{try{ee.value=!0;const p=Date.now();if(W.value&&X.value&&p-X.value<Ca){j.value=W.value;return}const r=await Re.get("http://localhost:8080/catchpre");j.value=r.data||[],W.value=r.data||[],X.value=p}catch(p){console.error("获取预测数据失败:",p),Ee.error("获取预测数据失败"),j.value=[]}finally{ee.value=!1}};xa(async()=>{try{ae.value=!0,await Promise.all([g(),N(),I()])}catch(p){console.error("初始化数据失败:",p),Ee.error("初始化数据失败")}finally{ae.value=!1}});const pe=()=>{if(m.value||(C.value="",D.value=""),C.value||(D.value=""),m.value&&C.value){const p=new Date(parseInt(m.value),parseInt(C.value),0).getDate();ye.value=Array.from({length:p},(r,k)=>({value:(k+1).toString(),label:`${k+1}日`}))}else ye.value=Array.from({length:31},(p,r)=>({value:(r+1).toString(),label:`${r+1}日`}));if(D.value&&m.value&&C.value){const p=new Date(parseInt(m.value),parseInt(C.value),0).getDate();parseInt(D.value)>p&&(D.value="")}Ke(()=>{R.value?(we(R.value),re(R.value),Q(R.value)):K()})},z=p=>{if(!Array.isArray(p)||p.length===0)return{labels:[],seriesData:[]};const r=[...new Set(p.map(d=>d.catch_fishery))];let k=[],c=[];if(m.value&&!C.value&&!D.value)k=Array.from({length:12},(d,f)=>`${f+1}月`),c=r.map(d=>{const f=new Array(12).fill(0);return p.filter(x=>x.catch_fishery===d).forEach(x=>{x.catch_year.toString()===m.value&&(f[parseInt(x.catch_month)-1]+=parseFloat(x.catch_weight||0))}),{name:d,type:"bar",stack:"total",data:f.map(x=>(x/1e3).toFixed(2))}});else if(m.value&&C.value&&!D.value){const d=new Date(parseInt(m.value),parseInt(C.value),0).getDate();k=Array.from({length:d},(f,x)=>`${x+1}日`),c=r.map(f=>{const x=new Array(d).fill(0);return p.filter(ie=>ie.catch_fishery===f).forEach(ie=>{ie.catch_year.toString()===m.value&&ie.catch_month.toString()===C.value&&(x[parseInt(ie.catch_day)-1]+=parseFloat(ie.catch_weight||0))}),{name:f,type:"bar",stack:"total",data:x.map(ie=>(ie/1e3).toFixed(2))}})}else m.value&&C.value&&D.value&&(k=Array.from({length:24},(d,f)=>`${f}:00`),c=r.map(d=>{const f=new Array(24).fill(0);return p.filter(x=>x.catch_fishery===d).forEach(x=>{if(x.catch_year.toString()===m.value&&x.catch_month.toString()===C.value&&x.catch_day.toString()===D.value){const ie=parseInt(x.catch_hour||0);f[ie]+=parseFloat(x.catch_weight||0)}}),{name:d,type:"bar",stack:"total",data:f.map(x=>x.toFixed(2))}}));return{labels:k,seriesData:c}},K=async()=>{try{ae.value=!0;const p=Date.now();if(R.value&&X.value&&p-X.value<Ca){we(R.value),re(R.value),Q(R.value);return}const r=await Re.get("http://localhost:8080/catch");R.value=r.data,X.value=p,r.data&&(we(r.data),re(r.data),Q(r.data))}catch(p){console.error("获取数据失败:",p),Ee.error("获取数据失败")}finally{ae.value=!1}},we=p=>{if(A.value&&(ce||(ce=Be(A.value)),!!m.value))try{const{labels:r,seriesData:k}=z(p),c={title:{text:"各渔场捕捞量统计",left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"shadow"},formatter:d=>{let f=d[0].name+"<br/>",x=0;return d.forEach(ie=>{f+=`${ie.seriesName}: ${ie.value}${D.value?"kg":"吨"}<br/>`,x+=parseFloat(ie.value)}),f+=`<br/>总计: ${x.toFixed(2)}${D.value?"kg":"吨"}`,f}},legend:{data:k.map(d=>d.name),top:30},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",data:r,axisLabel:{interval:0,rotate:C.value?30:0}},yAxis:{type:"value",name:D.value?"捕捞量(kg)":"捕捞量(吨)"},series:k};ce.setOption(c)}catch(r){console.error("处理数据失败:",r),Ee.error("处理数据失败")}},re=p=>{if(_e.value&&(y||(y=Be(_e.value)),!!m.value))try{const{seriesData:r}=_(p),k={title:{text:"各渔场捕捞量占比",left:"center"},tooltip:{trigger:"item",formatter:c=>`${c.name}: ${c.value}${D.value?"kg":"吨"} (${c.percent}%)`},legend:{orient:"vertical",left:"left",top:"middle"},series:[{name:"捕捞量占比",type:"pie",radius:"50%",data:r,emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]};y.setOption(k)}catch(r){console.error("处理数据失败:",r),Ee.error("处理数据失败")}};window.addEventListener("resize",()=>{ce&&G.value&&ce.resize(),y&&G.value&&y.resize(),s&&G.value&&s.resize()}),Sa(()=>{ce&&(ce.dispose(),ce=null),y&&(y.dispose(),y=null),s&&(s.dispose(),s=null),window.removeEventListener("resize",ta)});const ta=()=>{ce&&G.value&&ce.resize(),y&&G.value&&y.resize(),s&&G.value&&s.resize()};window.addEventListener("resize",ta);const Ge=P(()=>{if(!Y.value)return[];if(!be.value)return Y.value;const p=be.value.toLowerCase().trim();return Y.value.filter(r=>Object.values(r).some(k=>k&&String(k).toLowerCase().includes(p)))}),Me=P(()=>{if(!j.value)return[];if(!Oe.value)return j.value;const p=Oe.value.toLowerCase().trim();return j.value.filter(r=>Object.values(r).some(k=>k&&String(k).toLowerCase().includes(p)))}),Xe=P(()=>{const p=(E.value-1)*U.value;return Ge.value.slice(p,p+U.value)}),oa=P(()=>{const p=(M.value-1)*J.value;return Me.value.slice(p,p+J.value)}),je=()=>{be.value="",E.value=1},$=()=>{Oe.value="",M.value=1},la=p=>{U.value=p,E.value=1},na=p=>{E.value=p},sa=p=>{J.value=p,M.value=1},da=p=>{M.value=p},_=p=>{if(!Array.isArray(p)||p.length===0)return{seriesData:[]};const r=[...new Set(p.map(c=>c.catch_fishery))];let k=[];return m.value&&!C.value&&!D.value?k=r.map(c=>{const d=p.filter(f=>f.catch_fishery===c&&f.catch_year.toString()===m.value).reduce((f,x)=>f+parseFloat(x.catch_weight||0),0);return{name:c,value:(d/1e3).toFixed(2)}}):m.value&&C.value&&!D.value?k=r.map(c=>{const d=p.filter(f=>f.catch_fishery===c&&f.catch_year.toString()===m.value&&f.catch_month.toString()===C.value).reduce((f,x)=>f+parseFloat(x.catch_weight||0),0);return{name:c,value:(d/1e3).toFixed(2)}}):m.value&&D.value&&(k=r.map(c=>{const d=p.filter(f=>f.catch_fishery===c&&f.catch_year.toString()===m.value&&f.catch_month.toString()===C.value&&f.catch_day.toString()===D.value).reduce((f,x)=>f+parseFloat(x.catch_weight||0),0);return{name:c,value:d.toFixed(2)}})),{seriesData:k}},a=t(""),n=t(null);let s=null;const F=t([{value:"普陀渔场",label:"普陀渔场"},{value:"定海渔场",label:"定海渔场"},{value:"岱山渔场",label:"岱山渔场"},{value:"沈家门渔场",label:"沈家门渔场"},{value:"朱家尖渔场",label:"朱家尖渔场"},{value:"南洞渔场",label:"南洞渔场"},{value:"高亭渔场",label:"高亭渔场"}]),B=["鱼类","甲壳类","棘皮类","软体类","藻类"],T=()=>{a.value,R.value&&Q(R.value)},he=p=>{if(!Array.isArray(p)||p.length===0)return{seriesData:[]};let r=p;a.value&&(r=p.filter(d=>d.catch_fishery===a.value));let k=r;return m.value&&(k=k.filter(d=>d.catch_year.toString()===m.value),C.value&&(k=k.filter(d=>d.catch_month.toString()===C.value),D.value&&(k=k.filter(d=>d.catch_day.toString()===D.value)))),{seriesData:B.map(d=>{const f=k.filter(x=>x.catch_type===d).reduce((x,ie)=>x+parseFloat(ie.catch_weight||0),0);return{name:d,value:(f/1e3).toFixed(2)}})}},Q=p=>{if(n.value){s||(s=Be(n.value));try{const{seriesData:r}=he(p),k={title:{text:"海产品类型捕捞量占比",left:"center",top:30},tooltip:{trigger:"item",formatter:c=>`${c.name}: ${c.value}吨 (${c.percent}%)`},legend:{orient:"vertical",left:"left",top:"middle"},series:[{name:"捕捞量占比",type:"pie",radius:"50%",data:r,itemStyle:{color:function(c){return["#FF6B6B","#4ECDC4","#FFD93D","#FF8C42","#6C5CE7"][c.dataIndex]}},emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"},scale:!0,scaleSize:10}}]};s.setOption(k)}catch(r){console.error("处理数据失败:",r),Ee.error("处理数据失败")}}};return(p,r)=>{const k=rt,c=Da,d=Va,f=za,x=$a,ie=Pa,Te=st,Aa=nt,ya=ut,ra=ga,ba=ma,va=Ua,ha=La,Oa=_a,Ta=Fa;return v(),V(Oa,{modelValue:G.value,"onUpdate:modelValue":r[16]||(r[16]=w=>G.value=w),title:"渔场信息及捕捞数据中心",direction:"ltr",size:"90%","destroy-on-close":"",class:"fishery-center-drawer"},{default:u(()=>[h("div",vt,[e(ba,{modelValue:Ce.value,"onUpdate:modelValue":r[15]||(r[15]=w=>Ce.value=w),type:"card"},{default:u(()=>[e(ra,{label:"渔场详细信息",name:"info"},{default:u(()=>[h("div",ht,[e(d,{modelValue:te.value,"onUpdate:modelValue":r[0]||(r[0]=w=>te.value=w),placeholder:"输入任意字段进行模糊查询",clearable:"",onClear:Le,onInput:Se},{append:u(()=>[e(c,{onClick:Se},{default:u(()=>[e(k,null,{default:u(()=>[e(Ia(Ba))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),aa((v(),V(x,{data:Pe.value,border:"",style:{width:"100%"},height:"300",onRowClick:fe,"highlight-current-row":""},{default:u(()=>[e(f,{prop:"fsy_id",label:"渔场编号"}),e(f,{prop:"fsy_name",label:"渔场名"}),e(f,{prop:"fsy_area",label:"面积"}),e(f,{prop:"fsy_deep",label:"水深"}),e(f,{prop:"fsy_bottom",label:"底质"}),e(f,{prop:"fsy_resource",label:"鱼类资源"}),e(f,{prop:"fsy_opeart",label:"营业模式"}),e(f,{prop:"fsy_output",label:"产量"}),e(f,{prop:"fsy_value",label:"产值"}),e(f,{prop:"fsy_admin",label:"管理员"}),e(f,{prop:"fsy_phone",label:"电话"})]),_:1},8,["data"])),[[Ta,ae.value]]),e(ie,{"current-page":L.value,"onUpdate:currentPage":r[1]||(r[1]=w=>L.value=w),"page-size":oe.value,"onUpdate:pageSize":r[2]||(r[2]=w=>oe.value=w),total:Ye.value.length,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:ue,onCurrentChange:ne},null,8,["current-page","page-size","total"]),me.value?(v(),O("div",ft,[e(ba,{modelValue:ve.value,"onUpdate:modelValue":r[3]||(r[3]=w=>ve.value=w),type:"card",class:"fishery-detail-tabs"},{default:u(()=>[(v(!0),O(q,null,H(se.value,w=>(v(),V(ra,{key:w.fsy_id,label:w.fsy_name,name:w.fsy_id},{default:u(()=>[e(Aa,{title:w.fsy_name+"详细信息",column:2,border:""},{default:u(()=>[e(Te,{label:"渔场编号"},{default:u(()=>[De(Ve(w.fsy_id),1)]),_:2},1024),e(Te,{label:"面积"},{default:u(()=>[De(Ve(w.fsy_area),1)]),_:2},1024),e(Te,{label:"水深"},{default:u(()=>[De(Ve(w.fsy_deep),1)]),_:2},1024),e(Te,{label:"底质"},{default:u(()=>[De(Ve(w.fsy_bottom),1)]),_:2},1024),e(Te,{label:"鱼类资源"},{default:u(()=>[De(Ve(w.fsy_resource),1)]),_:2},1024),e(Te,{label:"营业模式"},{default:u(()=>[De(Ve(w.fsy_opeart),1)]),_:2},1024),e(Te,{label:"产量"},{default:u(()=>[De(Ve(w.fsy_output),1)]),_:2},1024),e(Te,{label:"产值"},{default:u(()=>[De(Ve(w.fsy_value),1)]),_:2},1024),e(Te,{label:"管理员"},{default:u(()=>[De(Ve(w.fsy_admin),1)]),_:2},1024),e(Te,{label:"电话"},{default:u(()=>[De(Ve(w.fsy_phone),1)]),_:2},1024)]),_:2},1032,["title"]),h("div",_t,[h("div",mt,[e(ya,{src:w.imageUrl||p.defaultImage,fit:"cover","preview-src-list":[w.imageUrl||p.defaultImage]},null,8,["src","preview-src-list"])]),h("div",gt,[h("div",yt,Ve(w.description||"暂无详细描述"),1)])])]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue"])])):ka("",!0)]),_:1}),e(ra,{label:"捕捞量统计",name:"stats"},{default:u(()=>[e(ba,{modelValue:Fe.value,"onUpdate:modelValue":r[10]||(r[10]=w=>Fe.value=w)},{default:u(()=>[e(ra,{label:"历史统计",name:"history"},{default:u(()=>[h("div",bt,[e(d,{modelValue:be.value,"onUpdate:modelValue":r[4]||(r[4]=w=>be.value=w),placeholder:"输入关键字搜索历史数据",clearable:"",style:{width:"300px"},onClear:je},{append:u(()=>[e(c,null,{default:u(()=>[e(k,null,{default:u(()=>[e(Ia(Ba))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e(x,{data:Xe.value,border:"",style:{width:"100%"},height:"500"},{default:u(()=>[e(f,{prop:"catch_fishery",label:"渔场名称",width:"100"}),e(f,{prop:"catch_ship",label:"渔船编号",width:"100"}),e(f,{prop:"catch_dock",label:"停靠码头",width:"170"}),e(f,{prop:"catch_company",label:"捕捞公司",width:"170"}),e(f,{prop:"catch_year",label:"年",width:"60"}),e(f,{prop:"catch_month",label:"月",width:"50"}),e(f,{prop:"catch_day",label:"日",width:"50"}),e(f,{prop:"catch_week",label:"周",width:"50"}),e(f,{prop:"catch_date",label:"日期",width:"130"}),e(f,{prop:"catch_hour",label:"时",width:"50"}),e(f,{prop:"catch_time",label:"时间",width:"130"}),e(f,{prop:"catch_type",label:"海产类别"}),e(f,{prop:"catch_name",label:"海产名称"}),e(f,{prop:"catch_weight",label:"重量/kg",width:"130"}),e(f,{prop:"catch_other",label:"备注"})]),_:1},8,["data"]),e(ie,{"current-page":E.value,"onUpdate:currentPage":r[5]||(r[5]=w=>E.value=w),"page-size":U.value,"onUpdate:pageSize":r[6]||(r[6]=w=>U.value=w),total:Ge.value.length,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:la,onCurrentChange:na,class:"pagination"},null,8,["current-page","page-size","total"])]),_:1}),e(ra,{label:"预测数据",name:"predict"},{default:u(()=>[h("div",wt,[e(d,{modelValue:Oe.value,"onUpdate:modelValue":r[7]||(r[7]=w=>Oe.value=w),placeholder:"输入关键字搜索预测数据",clearable:"",style:{width:"300px"},onClear:$},{append:u(()=>[e(c,null,{default:u(()=>[e(k,null,{default:u(()=>[e(Ia(Ba))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e(x,{data:oa.value,border:"",style:{width:"100%"},height:"500"},{default:u(()=>[e(f,{prop:"catch_Date",label:"预测日期"}),e(f,{prop:"catch_Time",label:"预测时间"}),e(f,{prop:"catch_Type",label:"捕捞类型"}),e(f,{prop:"catch_Weight",label:"预测重量(kg)"}),e(f,{prop:"catch_Ship",label:"捕捞船只"}),e(f,{prop:"catch_Dock",label:"靠泊码头",width:"200"}),e(f,{prop:"catch_Fishery",label:"所属渔场"}),e(f,{prop:"catch_Name",label:"海产品名称"}),e(f,{prop:"catch_Other",label:"备注","min-width":"200"})]),_:1},8,["data"]),e(ie,{"current-page":M.value,"onUpdate:currentPage":r[8]||(r[8]=w=>M.value=w),"page-size":J.value,"onUpdate:pageSize":r[9]||(r[9]=w=>J.value=w),total:Me.value.length,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:sa,onCurrentChange:da,class:"pagination"},null,8,["current-page","page-size","total"])]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(ra,{label:"图表展示",name:"charts"},{default:u(()=>[aa((v(),O("div",Ct,[h("div",kt,[e(ha,{modelValue:m.value,"onUpdate:modelValue":r[11]||(r[11]=w=>m.value=w),placeholder:"选择年份",onChange:pe,clearable:""},{default:u(()=>[(v(!0),O(q,null,H(ke.value,w=>(v(),V(va,{key:w.value,label:w.label,value:w.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e(ha,{modelValue:C.value,"onUpdate:modelValue":r[12]||(r[12]=w=>C.value=w),placeholder:"选择月份",onChange:pe,clearable:""},{default:u(()=>[(v(!0),O(q,null,H(xe.value,w=>(v(),V(va,{key:w.value,label:w.label,value:w.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e(ha,{modelValue:D.value,"onUpdate:modelValue":r[13]||(r[13]=w=>D.value=w),placeholder:"选择日期",onChange:pe,clearable:""},{default:u(()=>[(v(!0),O(q,null,H(ye.value,w=>(v(),V(va,{key:w.value,label:w.label,value:w.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),h("div",xt,[h("div",St,[h("div",{ref_key:"chartRef",ref:A,style:{width:"140vh",height:"500px"}},null,512)]),h("div",Vt,[h("div",{ref_key:"pieChartRef",ref:_e,style:{width:"70vh",height:"400px"}},null,512),h("div",Dt,[h("div",$t,[e(ha,{modelValue:a.value,"onUpdate:modelValue":r[14]||(r[14]=w=>a.value=w),placeholder:"选择渔场",clearable:"",onChange:T},{default:u(()=>[(v(!0),O(q,null,H(F.value,w=>(v(),V(va,{key:w.value,label:w.label,value:w.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),h("div",{ref_key:"typePieChartRef",ref:n,style:{width:"70vh",height:"400px"}},null,512)])])])])),[[Ta,ae.value]])]),_:1}),e(ra,{label:"捕捞量预测",name:"prediction"},{default:u(()=>r[17]||(r[17]=[h("div",null,"这里是捕鱼量预测图表",-1)])),_:1})]),_:1},8,["modelValue"])])]),_:1},8,["modelValue"])}}},oo=pa(zt,[["__scopeId","data-v-7b446db3"]]),Ft={class:"drawer-content"},Pt={class:"water-table-container"},Lt={class:"pikachu-container"},Ut={class:"speech-bubble"},At={class:"filter-container"},Tt={class:"chart-container"},Ot={class:"chart-filter"},Et={class:"chart-wrapper"},Mt={class:"chart-wrapper"},Ra="http://localhost:8080/water",It={__name:"WaterCenter",props:{modelValue:{type:Boolean,required:!0,default:!1}},emits:["update:modelValue"],setup(We,{emit:Ne}){const Ae=We,ze=Ne,G=P({get:()=>Ae.modelValue,set:a=>ze("update:modelValue",a)}),Ce={year:2024,month:12,day:1},Fe=t("today"),L=t("普陀渔场"),oe=t(!1);t(null);const te=t(["普陀渔场","定海渔场","岱山渔场","沈家门渔场","朱家尖渔场","南洞渔场","高亭渔场"]),ae=t([]),ee=t([]);t(0);const se=t(1),me=t(20),ve=t(""),Y=t(""),j=t(""),E=t(""),U=t(""),M=t(""),J=t(""),A=t(""),_e=t(null),ce=t(null);let y=null,m=null;const C=t(1),D=t(20),ke=t({}),xe=t(!0),ye=t([]),$e=t({fishery:null,year:null,month:null,day:null}),R=t(!1);t(!1),t(null);const W=t({today:!1,records:!1,charts:!1});Qe(()=>G.value,a=>{a&&(console.log("抽屉打开，预加载所有数据"),X())},{immediate:!0});const X=async()=>{xe.value&&(console.log("首次加载，预加载所有标签页数据"),Promise.all([be(),Oe()]).then(()=>{console.log("所有数据加载完成"),xe.value=!1,Ke(()=>{Fe.value==="charts"&&Ye()})}).catch(a=>{console.error("预加载数据出错:",a),Ee.error("数据加载失败，请重试")}))},be=()=>W.value.today?(console.log("今日数据已加载，跳过"),Promise.resolve()):(console.log("开始加载今日数据"),oe.value=!0,Re.get(Ra).then(a=>{a.data&&a.data.length>0?(ae.value=a.data,console.log(`获取到${ae.value.length}条水质数据`),ke.value={},W.value.today=!0):(console.warn("未找到水质数据"),ae.value=[])}).catch(a=>{console.error("获取今日水质数据失败:",a),Ee.error("获取水质数据失败"),ae.value=[]}).finally(()=>{oe.value=!1})),Oe=()=>W.value.records?(console.log("水质记录已加载，跳过"),Promise.resolve()):(console.log("开始加载水质记录"),oe.value=!0,Re.get(Ra).then(a=>{if(a.data&&a.data.length>0){ee.value=a.data,console.log(`获取到${ee.value.length}条水质记录`);const n=[...new Set(ee.value.map(s=>s.water_year))].sort();fe.value=n,W.value.records=!0}else console.warn("未找到水质记录"),ee.value=[]}).catch(a=>{console.error("获取水质记录失败:",a),Ee.error("获取水质记录失败"),ee.value=[]}).finally(()=>{oe.value=!1})),Ye=()=>{if(R.value){console.log("图表已初始化，跳过");return}console.log("初始化图表...");const a=_e.value,n=ce.value;if(!a||!n){console.error("图表容器未找到，将在下次DOM更新后重试");return}y&&y.dispose(),m&&m.dispose(),y=Be(a),m=Be(n),y.showLoading({text:"加载中..."}),m.showLoading({text:"加载中..."});const s=()=>{y&&y.resize(),m&&m.resize()};window.addEventListener("resize",s),R.value=!0,console.log("图表初始化完成"),W.value.records&&ee.value.length>0&&(Pe(),W.value.charts=!0)},Pe=()=>{if(!y||!m){console.error("图表实例未初始化");return}if(y.showLoading({text:"处理数据..."}),m.showLoading({text:"处理数据..."}),console.log("处理图表数据..."),ee.value&&ee.value.length>0){let a=[...ee.value];U.value&&(a=a.filter(s=>s.water_fishery===U.value)),M.value&&(a=a.filter(s=>s.water_year===M.value)),J.value&&(a=a.filter(s=>s.water_month===J.value)),A.value&&(a=a.filter(s=>s.water_day===A.value)),console.log(`筛选后数据: ${a.length}条记录`);const n=Se(a);Le(n)}else oe.value=!0,console.log("获取水质记录数据用于图表..."),Re.get(Ra).then(a=>{a.data&&a.data.length>0?(ee.value=a.data,console.log(`获取到${ee.value.length}条水质记录`),Pe()):(console.error("获取图表数据失败: 返回数据为空"),Ee.warning("暂无水质数据"),Le({trendData:[],timePoints:[],xAxisType:"year",xAxisLabel:"年份",pieData:[]}))}).catch(a=>{console.error("获取图表数据失败:",a),Ee.error(`获取图表数据失败: ${a.message||"未知错误"}`),Le({trendData:[],timePoints:[],xAxisType:"year",xAxisLabel:"年份",pieData:[]})}).finally(()=>{oe.value=!1})},Se=a=>{if(console.time("处理图表数据"),!a||a.length===0)return console.timeEnd("处理图表数据"),{trendData:[],timePoints:[],xAxisType:"year",xAxisLabel:"年份",pieData:[{value:0,name:"水质优秀"},{value:0,name:"水质良好"},{value:0,name:"水质较差"}]};let n="year",s="water_year",F="年份";M.value&&J.value&&A.value?(n="hour",s="water_hour",F="小时"):M.value&&J.value?(n="day",s="water_day",F="日期"):M.value&&(n="month",s="water_month",F="月份");let B=[...new Set(a.map(f=>f[s]))].sort((f,x)=>f-x);if(B.length===0)return console.timeEnd("处理图表数据"),{trendData:[],timePoints:[],xAxisType:n,xAxisLabel:F,pieData:[{value:0,name:"水质优秀"},{value:0,name:"水质良好"},{value:0,name:"水质较差"}]};const T=[{field:"water_T",name:"浊度"},{field:"water_MN",name:"高锰酸钾指数"},{field:"water_PH",name:"PH值"},{field:"water_DO",name:"溶解氧"},{field:"water_TCL",name:"总氯"},{field:"water_HCL",name:"氢氯"},{field:"water_temp",name:"水温"},{field:"water_TN",name:"总氮"},{field:"water_NO2",name:"亚硝酸盐"},{field:"water_NO3",name:"硝酸盐"},{field:"water_TP",name:"总磷"},{field:"water_S",name:"盐度"},{field:"water_SS",name:"悬浮物"},{field:"water_HM",name:"重金属"},{field:"water_mark",name:"水质分数"}],he={},Q={};T.forEach(f=>{he[f.field]={},Q[f.field]={},B.forEach(x=>{he[f.field][x]=0,Q[f.field][x]=0})}),a.forEach(f=>{const x=f[s];T.forEach(ie=>{const Te=parseFloat(f[ie.field])||0;he[ie.field][x]+=Te,Q[ie.field][x]++})});const p=T.map(f=>{const x=B.map(ie=>{const Te=Q[f.field][ie];if(Te===0)return null;const ya=he[f.field][ie]/Te;return parseFloat(ya.toFixed(2))});return{name:f.name,type:"line",smooth:!0,data:x}}),r=a.filter(f=>f.water_mark>=80).length,k=a.filter(f=>f.water_mark>=60&&f.water_mark<80).length,c=a.filter(f=>f.water_mark<60).length,d=[{value:r,name:"水质优秀"},{value:k,name:"水质良好"},{value:c,name:"水质较差"}];return console.timeEnd("处理图表数据"),{trendData:p,timePoints:B,xAxisType:n,xAxisLabel:F,pieData:d}},Le=a=>{if(!y||!m){console.error("图表实例未初始化");return}if(console.log("更新图表数据:",a),y.hideLoading(),m.hideLoading(),!a||!a.trendData||!a.timePoints){console.error("图表数据无效"),y.setOption({title:{text:"暂无数据",left:"center",top:"center"},series:[]},!0),m.setOption({title:{text:"暂无数据",left:"center",top:"center"},series:[]},!0);return}try{const n=["#FF4500","#00CD66","#1E90FF","#FFD700","#FF1493","#00FFFF","#FF8C00","#9932CC","#00FF7F","#4169E1","#FF00FF","#00FF00","#FFA500","#9400D3","#FF6347"],s={color:n,title:{text:U.value?`${U.value}水质指标趋势`:"水质指标趋势",left:"center",textStyle:{fontSize:20,fontWeight:"bold"}},tooltip:{trigger:"axis",axisPointer:{type:"shadow"},backgroundColor:"rgba(255, 255, 255, 0.9)",borderColor:"#ccc",borderWidth:1,textStyle:{color:"#333"},formatter:function(B){let T=B[0].axisValueLabel+"<br/>";return B.forEach(he=>{T+=`<div style="display:flex;align-items:center;margin:3px 0;">
                        <span style="display:inline-block;width:12px;height:12px;background:${he.color};margin-right:5px;border-radius:50%;"></span>
                        <span>${he.seriesName}：<b>${he.value||"-"}</b></span>
                      </div>`}),T}},legend:{data:a.trendData.map(B=>B.name),type:"scroll",orient:"horizontal",top:40,padding:[5,10],itemGap:12,textStyle:{fontSize:12},pageIconSize:12},grid:{left:"3%",right:"5%",bottom:"5%",top:"100px",containLabel:!0},toolbox:{feature:{saveAsImage:{title:"保存图片"},restore:{title:"重置"}},right:20,iconStyle:{borderColor:"#999"}},xAxis:{type:"category",name:a.xAxisLabel,data:a.timePoints,axisLine:{lineStyle:{color:"#999",width:2}},axisTick:{alignWithLabel:!0,length:6},axisLabel:{formatter:B=>a.xAxisType==="month"?`${B}月`:a.xAxisType==="day"?`${B}日`:a.xAxisType==="hour"?`${B}时`:B,margin:12,color:"#333",fontSize:12,fontWeight:"bold"},nameTextStyle:{color:"#333",fontSize:14,fontWeight:"bold"}},yAxis:{type:"value",name:"指标值",nameTextStyle:{color:"#333",fontSize:14,fontWeight:"bold",padding:[0,0,0,30]},axisLine:{show:!0,lineStyle:{color:"#999",width:2}},splitLine:{lineStyle:{type:"dashed",color:"#ddd"}}},series:a.trendData.map(B=>({...B,lineStyle:{width:5,shadowColor:"rgba(0, 0, 0, 0.3)",shadowBlur:12},symbolSize:8,emphasis:{focus:"series",lineStyle:{width:7},itemStyle:{borderWidth:3,shadowBlur:10,shadowColor:"rgba(0, 0, 0, 0.5)"}},smooth:!0}))},F={color:n,title:{text:U.value?`${U.value}水质分数比例`:"水质分数比例",left:"center",textStyle:{fontSize:20,fontWeight:"bold"}},tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)",backgroundColor:"rgba(255, 255, 255, 0.9)",borderColor:"#ccc",borderWidth:1,textStyle:{color:"#333"}},legend:{orient:"horizontal",top:40,data:["水质优秀","水质良好","水质较差"],itemGap:25,textStyle:{fontSize:14,fontWeight:"bold"}},series:[{name:"水质分数",type:"pie",radius:["40%","70%"],center:["50%","60%"],avoidLabelOverlap:!1,itemStyle:{borderRadius:12,borderColor:"#fff",borderWidth:2,shadowBlur:15,shadowColor:"rgba(0, 0, 0, 0.3)"},label:{show:!0,formatter:"{b}: {c} ({d}%)",fontSize:14,fontWeight:"bold",textShadowBlur:2,textShadowColor:"rgba(255, 255, 255, 1)"},emphasis:{label:{show:!0,fontSize:16,fontWeight:"bold",shadowBlur:10,shadowColor:"rgba(0, 0, 0, 0.3)"},itemStyle:{shadowBlur:20,borderWidth:3}},labelLine:{length:15,length2:12,smooth:!0,lineStyle:{width:2}},data:a.pieData}],animationDuration:1e3,animationEasing:"elasticOut"};y.setOption(s,!0),m.setOption(F,!0),console.log("图表更新完成")}catch(n){console.error("更新图表出错:",n),Ee.error("图表更新失败")}},ue=a=>{const n=a.props.name;console.log("切换到标签页:",n),n==="today"&&!W.value.today?fetchTodayData():n==="records"&&!W.value.records?fetchWaterRecords():n==="charts"&&!R.value&&Ke(()=>{Ye()})},ne=()=>{Pe()};xa(()=>{console.log("水质监测组件挂载"),G.value&&X()}),Sa(()=>{y&&(y.dispose(),y=null),m&&(m.dispose(),m=null),window.removeEventListener("resize",re)});const fe=P(()=>{const a=[...new Set(ee.value.map(n=>n.water_year))];return a.length>10?a.sort((n,s)=>s-n).slice(0,10):a.sort((n,s)=>s-n)}),b=P(()=>{if(!Y.value)return[];const a=ee.value.filter(s=>s.water_year===Y.value);return[...new Set(a.map(s=>s.water_month))].sort((s,F)=>s-F)}),g=P(()=>{if(!Y.value||!j.value)return[];const a=ee.value.filter(s=>s.water_year===Y.value&&s.water_month===j.value);return[...new Set(a.map(s=>s.water_day))].sort((s,F)=>s-F)}),N=P(()=>{if(!M.value)return[];const a=ee.value.filter(s=>s.water_year===M.value);return[...new Set(a.map(s=>s.water_month))].sort((s,F)=>s-F)}),I=P(()=>{if(!M.value||!J.value)return[];const a=ee.value.filter(s=>s.water_year===M.value&&s.water_month===J.value);return[...new Set(a.map(s=>s.water_day))].sort((s,F)=>s-F)}),pe=a=>{const n=Me(a),s=(C.value-1)*D.value,F=s+D.value;return n.slice(s,F)},z=a=>{console.log("今日数据页大小变更:",a),D.value=a,C.value=1},K=a=>{console.log("今日数据页码变更:",a),C.value=a},we=a=>{console.log("关闭抽屉"),a()},re=()=>{y&&G.value&&y.resize(),m&&G.value&&m.resize()},ta=a=>{J.value=null,A.value=null,ne()},Ge=a=>{A.value=null,ne()},Me=a=>{if(ke.value[a])return ke.value[a];const n=ae.value.filter(s=>s.water_fishery===a&&s.water_year===Ce.year&&s.water_month===Ce.month&&s.water_day===Ce.day);return ke.value[a]=n,n},Xe=a=>{const n=Me(a);if(n.length===0)return"normal";const F=n.reduce((B,T)=>B+T.water_mark,0)/n.length;return F>=80?"happy":F>=60?"normal":"sad"},oa=a=>{const n=Xe(a),s=Me(a);if(s.length===0)return`没有${Ce.year}年${Ce.month}月${Ce.day}日的水质数据`;const B=s.reduce((T,he)=>T+he.water_mark,0)/s.length;return n==="happy"?`${a}水质优秀(${B.toFixed(1)}分)!`:n==="normal"?`${a}水质良好(${B.toFixed(1)}分)`:`${a}水质较差(${B.toFixed(1)}分)，需要改善!`},je=()=>{console.log("筛选条件变化:",{fishery:ve.value,year:Y.value,month:j.value,day:E.value}),se.value=1,ee.value.length===0&&fetchWaterRecords()},$=a=>{console.log("年份变化:",a),j.value="",E.value="",je()},la=a=>{console.log("月份变化:",a),E.value="",je()},na=P(()=>{const a={fishery:ve.value,year:Y.value,month:j.value,day:E.value};if(ye.value.length>0&&JSON.stringify(a)===JSON.stringify($e.value))return ye.value;const n=ee.value.filter(s=>{let F=!0;return ve.value&&(F=F&&s.water_fishery===ve.value),Y.value&&(F=F&&s.water_year===Y.value),j.value&&(F=F&&s.water_month===j.value),E.value&&(F=F&&s.water_day===E.value),F});return ye.value=n,$e.value={...a},n}),sa=P(()=>{const a=(se.value-1)*me.value,n=a+me.value;return na.value.slice(a,n)}),da=a=>{console.log("记录页面大小变更:",a),me.value=a,se.value=1},_=a=>{console.log("记录页码变更:",a),se.value=a};return(a,n)=>{const s=za,F=$a,B=Pa,T=ga,he=ma,Q=Ua,p=La,r=_a,k=Fa;return v(),V(r,{modelValue:G.value,"onUpdate:modelValue":n[14]||(n[14]=c=>G.value=c),title:"水质监测中心",direction:"ttb",size:"90%","with-header":!0,"before-close":we,"destroy-on-close":!1,class:"water-monitor-drawer"},{default:u(()=>[h("div",Ft,[e(he,{modelValue:Fe.value,"onUpdate:modelValue":n[13]||(n[13]=c=>Fe.value=c),type:"card",onTabClick:ue},{default:u(()=>[e(T,{label:"今日水质",name:"today"},{default:u(()=>[e(he,{modelValue:L.value,"onUpdate:modelValue":n[2]||(n[2]=c=>L.value=c),type:"card",class:"fishery-tabs"},{default:u(()=>[(v(!0),O(q,null,H(te.value,c=>(v(),V(T,{key:c,label:c,name:c},{default:u(()=>[h("div",Pt,[aa((v(),V(F,{data:pe(c),border:"",style:{width:"100%"},height:"500"},{default:u(()=>[e(s,{prop:"water_fishery",label:"采样渔场",width:"120"}),e(s,{prop:"water_year",label:"采样年",width:"80"}),e(s,{prop:"water_month",label:"采样月",width:"80"}),e(s,{prop:"water_day",label:"采样日",width:"80"}),e(s,{prop:"water_hour",label:"采样时",width:"80"}),e(s,{prop:"water_T",label:"浊度"}),e(s,{prop:"water_MN",label:"高锰酸钾指数"}),e(s,{prop:"water_PH",label:"PH值"}),e(s,{prop:"water_DO",label:"溶解氧"}),e(s,{prop:"water_TCL",label:"总氯"}),e(s,{prop:"water_HCL",label:"氢氯"}),e(s,{prop:"water_temp",label:"水温(22度)"}),e(s,{prop:"water_TN",label:"总氮"}),e(s,{prop:"water_NO2",label:"亚硝酸盐"}),e(s,{prop:"water_NO3",label:"硝酸盐"}),e(s,{prop:"water_TP",label:"总磷"}),e(s,{prop:"water_S",label:"盐度"}),e(s,{prop:"water_SS",label:"悬浮物"}),e(s,{prop:"water_HM",label:"重金属"}),e(s,{prop:"water_mark",label:"水质分数"})]),_:2},1032,["data"])),[[k,oe.value]]),e(B,{"current-page":C.value,"onUpdate:currentPage":n[0]||(n[0]=d=>C.value=d),"page-size":D.value,"onUpdate:pageSize":n[1]||(n[1]=d=>D.value=d),total:Me(c).length,layout:"total, sizes, prev, pager, next, jumper","page-sizes":[10,20,50,100],onSizeChange:z,onCurrentChange:K},null,8,["current-page","page-size","total"]),h("div",Lt,[h("div",{class:Na(["pikachu",Xe(c)])},[h("div",Ut,Ve(oa(c)),1)],2)])])]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(T,{label:"水质记录",name:"records"},{default:u(()=>[h("div",At,[e(p,{modelValue:ve.value,"onUpdate:modelValue":n[3]||(n[3]=c=>ve.value=c),placeholder:"选择渔场",clearable:"",style:{width:"200px","margin-right":"15px"},onChange:je},{default:u(()=>[(v(!0),O(q,null,H(te.value,c=>(v(),V(Q,{key:c,label:c,value:c},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e(p,{modelValue:Y.value,"onUpdate:modelValue":n[4]||(n[4]=c=>Y.value=c),placeholder:"选择年份",clearable:"",style:{width:"120px","margin-right":"15px"},onChange:$},{default:u(()=>[(v(!0),O(q,null,H(fe.value,c=>(v(),V(Q,{key:c,label:`${c}年`,value:c},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e(p,{modelValue:j.value,"onUpdate:modelValue":n[5]||(n[5]=c=>j.value=c),placeholder:"选择月份",clearable:"",disabled:!Y.value,style:{width:"120px","margin-right":"15px"},onChange:la},{default:u(()=>[(v(!0),O(q,null,H(b.value,c=>(v(),V(Q,{key:c,label:`${c}月`,value:c},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"]),e(p,{modelValue:E.value,"onUpdate:modelValue":n[6]||(n[6]=c=>E.value=c),placeholder:"选择日期",clearable:"",disabled:!j.value,style:{width:"120px"},onChange:je},{default:u(()=>[(v(!0),O(q,null,H(g.value,c=>(v(),V(Q,{key:c,label:`${c}日`,value:c},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),aa((v(),V(F,{data:sa.value,border:"",style:{width:"100%"},height:"600"},{default:u(()=>[e(s,{prop:"water_fishery",label:"采样渔场",width:"120"}),e(s,{prop:"water_year",label:"采样年",width:"80"}),e(s,{prop:"water_month",label:"采样月",width:"80"}),e(s,{prop:"water_day",label:"采样日",width:"80"}),e(s,{prop:"water_hour",label:"采样时",width:"80"}),e(s,{prop:"water_T",label:"浊度"}),e(s,{prop:"water_MN",label:"高锰酸钾指数"}),e(s,{prop:"water_PH",label:"PH值"}),e(s,{prop:"water_DO",label:"溶解氧"}),e(s,{prop:"water_TCL",label:"总氯"}),e(s,{prop:"water_HCL",label:"氢氯"}),e(s,{prop:"water_temp",label:"水温"}),e(s,{prop:"water_TN",label:"总氮"}),e(s,{prop:"water_NO2",label:"亚硝酸盐"}),e(s,{prop:"water_NO3",label:"硝酸盐"}),e(s,{prop:"water_TP",label:"总磷"}),e(s,{prop:"water_S",label:"盐度"}),e(s,{prop:"water_SS",label:"悬浮物"}),e(s,{prop:"water_HM",label:"重金属"}),e(s,{prop:"water_mark",label:"水质分数"})]),_:1},8,["data"])),[[k,oe.value]]),e(B,{"current-page":se.value,"onUpdate:currentPage":n[7]||(n[7]=c=>se.value=c),"page-size":me.value,"onUpdate:pageSize":n[8]||(n[8]=c=>me.value=c),total:na.value.length,layout:"total, sizes, prev, pager, next, jumper","page-sizes":[10,20,50,100],onSizeChange:da,onCurrentChange:_},null,8,["current-page","page-size","total"])]),_:1}),e(T,{label:"水质图表",name:"charts"},{default:u(()=>[h("div",Tt,[h("div",Ot,[e(p,{modelValue:U.value,"onUpdate:modelValue":n[9]||(n[9]=c=>U.value=c),placeholder:"选择渔场",clearable:"",style:{width:"200px","margin-right":"15px"},onChange:ne},{default:u(()=>[(v(!0),O(q,null,H(te.value,c=>(v(),V(Q,{key:c,label:c,value:c},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e(p,{modelValue:M.value,"onUpdate:modelValue":n[10]||(n[10]=c=>M.value=c),placeholder:"选择年份",clearable:"",style:{width:"120px","margin-right":"15px"},onChange:ta},{default:u(()=>[(v(!0),O(q,null,H(fe.value,c=>(v(),V(Q,{key:c,label:`${c}年`,value:c},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e(p,{modelValue:J.value,"onUpdate:modelValue":n[11]||(n[11]=c=>J.value=c),placeholder:"选择月份",clearable:"",disabled:!M.value,style:{width:"120px","margin-right":"15px"},onChange:Ge},{default:u(()=>[(v(!0),O(q,null,H(N.value,c=>(v(),V(Q,{key:c,label:`${c}月`,value:c},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"]),e(p,{modelValue:A.value,"onUpdate:modelValue":n[12]||(n[12]=c=>A.value=c),placeholder:"选择日期",clearable:"",disabled:!J.value,style:{width:"120px"},onChange:ne},{default:u(()=>[(v(!0),O(q,null,H(I.value,c=>(v(),V(Q,{key:c,label:`${c}日`,value:c},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),h("div",Et,[h("div",{ref_key:"waterTrendChart",ref:_e,style:{width:"100%",height:"500px"}},null,512)]),h("div",Mt,[h("div",{ref_key:"waterPieChart",ref:ce,style:{width:"100%",height:"400px"}},null,512)])])]),_:1})]),_:1},8,["modelValue"])])]),_:1},8,["modelValue"])}}},ro=pa(It,[["__scopeId","data-v-406cc82d"]]),Bt={class:"drawer-content"},Rt={class:"header"},Wt={class:"filter-container"},Nt={class:"date-filters"},Yt={class:"pagination-container"},jt={class:"charts-container"},qt={class:"filter-container"},Ht={class:"date-filters"},Qt={class:"chart-container"},Kt={__name:"TranCenter",setup(We,{expose:Ne}){const Ae=t(!1),ze=t("records"),G=t(!1),Ce=t(!1),Fe=t(""),L=t([]),oe=t(""),te=t(1),ae=t(20),ee=t([2022,2023,2024]),se=t([1,2,3,4,5,6,7,8,9,10,11,12]),me=t(Array.from({length:31},(b,g)=>g+1)),ve=t(null),Y=t(null),j=t(null),E=t(null),U=t(null),M=t(null),J=t(null);let A=null;const _e=t({fleet:!1});P(()=>L.value.length>0&&L.value.every(b=>typeof b=="object"&&b!==null&&"dock_out_weight"in b&&"dock_out_company"in b));const ce=()=>{Ae.value=!0,C()},y=()=>{Ae.value=!1},m=b=>{b()},C=async()=>{if(!_e.value.fleet){G.value=!0,Ce.value=!1,Fe.value="";try{const b=await Re.get("http://localhost:8080/trans");if(!b.data)throw new Error("No data received");L.value=Array.isArray(b.data)?b.data.map(g=>({id:g.id,dock_out_year:parseInt(g.dock_out_year),dock_out_month:parseInt(g.dock_out_month),dock_out_day:parseInt(g.dock_out_day),dock_out_hour:parseInt(g.dock_out_hour),dock_out_time:g.dock_out_time,dock_out_fleet:g.dock_out_fleet,dock_out_company:g.dock_out_company,dock_out_name:g.dock_out_name,dock_out_type:g.dock_out_type,dock_out_weight:parseFloat(g.dock_out_weight||0),dock_out_other:g.dock_out_other})):[],_e.value.fleet=!0,console.log("Fleet data loaded:",L.value.length,"records"),ze.value==="charts"&&Ke(()=>{ue()})}catch(b){console.error("Failed to load fleet data:",b),Fe.value=b.response?`Server error: ${b.response.status}`:`Request failed: ${b.message}`,Ce.value=!0,L.value=[]}finally{G.value=!1}}},D=P(()=>{console.log("Filtering data:",{total:L.value.length,searchQuery:oe.value,year:ve.value,month:Y.value,day:j.value});let b=L.value;if(oe.value){const g=oe.value.toLowerCase();b=b.filter(N=>N.id&&N.id.toString().includes(g)||N.dock_out_fleet&&N.dock_out_fleet.toLowerCase().includes(g)||N.dock_out_company&&N.dock_out_company.toLowerCase().includes(g)||N.dock_out_name&&N.dock_out_name.toLowerCase().includes(g)||N.dock_out_type&&N.dock_out_type.toLowerCase().includes(g)||N.dock_out_other&&N.dock_out_other.toLowerCase().includes(g))}return ve.value&&(b=b.filter(g=>g.dock_out_year===ve.value),Y.value&&(b=b.filter(g=>g.dock_out_month===Y.value),j.value&&(b=b.filter(g=>g.dock_out_day===j.value)))),console.log("Filtered result:",b.length),b}),ke=P(()=>{const b=(te.value-1)*ae.value;return D.value.slice(b,b+ae.value)}),xe=b=>{ae.value=b,te.value=1},ye=b=>{te.value=b},$e=()=>{te.value=1},R=()=>{oe.value="",te.value=1},W=()=>{Y.value=null,j.value=null,te.value=1},X=()=>{j.value=null,te.value=1},be=()=>{te.value=1},Oe=()=>{ve.value=null,Y.value=null,j.value=null,oe.value="",te.value=1},Ye=()=>{U.value=null,M.value=null,Se()},Pe=()=>{M.value=null,Se()},Se=()=>{if(!A||!L.value.length){console.log("No chart instance or no data");return}console.log("Updating chart with data:",{year:E.value,month:U.value,day:M.value});let b=L.value,g=[],N="";if(E.value)if(b=b.filter(I=>I.dock_out_year===E.value),U.value)if(b=b.filter(I=>I.dock_out_month===U.value),M.value){b=b.filter(z=>z.dock_out_day===M.value),g=Array.from({length:24},(z,K)=>K),N="小时";const I={};b.forEach(z=>{const K=z.dock_out_company||"未知公司",we=z.dock_out_hour||0,re=z.dock_out_weight||0;I[K]||(I[K]=Array(24).fill(0)),I[K][we]+=re});const pe=Object.keys(I).map(z=>({name:z,emphasis:{focus:"series"},data:I[z].map(K=>parseFloat(K.toFixed(2)))}));Le(g.map(z=>`${z}时`),pe,`${E.value}年${U.value}月${M.value}日各公司运输量统计`,N)}else{g=Array.from({length:31},(z,K)=>K+1),N="日期";const I={};b.forEach(z=>{const K=z.dock_out_company||"未知公司",we=z.dock_out_day||1,re=z.dock_out_weight||0;I[K]||(I[K]=Array(31).fill(0)),I[K][we-1]+=re});const pe=Object.keys(I).map(z=>({name:z,type:"line",smooth:!0,emphasis:{focus:"series"},areaStyle:{},data:I[z].map(K=>parseFloat(K.toFixed(2)))}));Le(g.map(z=>`${z}日`),pe,`${E.value}年${U.value}月各公司运输量统计`,N)}else{g=Array.from({length:12},(z,K)=>K+1),N="月份";const I={};b.forEach(z=>{const K=z.dock_out_company||"未知公司",we=z.dock_out_month||1,re=z.dock_out_weight||0;I[K]||(I[K]=Array(12).fill(0)),I[K][we-1]+=re});const pe=Object.keys(I).map(z=>({name:z,type:"bar",emphasis:{focus:"series"},data:I[z].map(K=>parseFloat(K.toFixed(2)))}));Le(g.map(z=>`${z}月`),pe,`${E.value}年各公司月度运输量统计`,N)}else A.setOption({title:{text:"请选择年份查看运输量统计",left:"center",top:"center",textStyle:{fontSize:16,fontWeight:"bold"}},xAxis:{show:!1},yAxis:{show:!1},series:[]})},Le=(b,g,N,I)=>{const pe=["#FF6B6B","#4ECDC4","#45B7D1","#96CEB4","#FFD93D","#FF8C42","#D741A7","#6C5CE7","#A8E6CF"];A.setOption({color:pe,title:{text:N,left:"center",top:10,textStyle:{fontSize:18,fontWeight:"bold"}},tooltip:{trigger:"axis",axisPointer:{type:"cross"},formatter:function(z){let K=z[0].axisValue+"<br/>",we=0;return z.forEach(re=>{we+=re.value,K+=`${re.marker} ${re.seriesName}: ${re.value.toFixed(2)}吨<br/>`}),K+=`<b>总计: ${we.toFixed(2)}吨</b>`,K}},legend:{type:"scroll",orient:"horizontal",top:50,left:"center"},grid:{left:"3%",right:"4%",bottom:"3%",top:100,containLabel:!0},xAxis:{type:"category",boundaryGap:!1,name:I,data:b,axisLabel:{interval:0,rotate:b.length>12?45:0}},yAxis:{type:"value",name:"运输量(吨)",axisLabel:{formatter:"{value} 吨"}},series:g.map(z=>({...z,type:"line",smooth:!0,lineStyle:{width:3},areaStyle:{opacity:.3,color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgba(255, 255, 255, 0)"},{offset:1,color:"rgba(255, 255, 255, 0.3)"}]}},emphasis:{focus:"series",areaStyle:{opacity:.8}},symbol:"circle",symbolSize:8,showSymbol:!1}))})};Qe(Ae,b=>{b?C():(_e.value.fleet=!1,L.value=[],A&&(A.dispose(),A=null))}),Qe(ze,b=>{b==="charts"&&Ke(()=>{_e.value.fleet?L.value.length>0&&setTimeout(()=>{ue()},300):C()})}),Qe([E,U,M],()=>{ze.value==="charts"&&A&&Se()});const ue=()=>{if(console.log("Initializing chart..."),!J.value){console.error("Chart container not found");return}try{A&&A.dispose(),A=Be(J.value),console.log("Chart instance created"),ne(),Se(),window.addEventListener("resize",fe)}catch(b){console.error("Chart initialization failed:",b)}},ne=()=>{if(L.value&&L.value.length>0){const g=[...L.value].sort((N,I)=>{const pe=new Date(N.dock_out_year,N.dock_out_month-1,N.dock_out_day);return new Date(I.dock_out_year,I.dock_out_month-1,I.dock_out_day)-pe})[0];E.value=g.dock_out_year,U.value=g.dock_out_month,M.value=g.dock_out_day,console.log("Set default date to:",`${E.value}-${U.value}-${M.value}`)}},fe=()=>{A&&Ae.value&&A.resize()};return xa(()=>{window.addEventListener("resize",()=>{A&&A.resize()})}),Sa(()=>{A&&(A.dispose(),A=null),window.removeEventListener("resize",fe)}),Ne({open:ce}),(b,g)=>{const N=Da,I=Va,pe=Ua,z=La,K=it,we=Ya,re=za,ta=$a,Ge=Pa,Me=ga,Xe=ma,oa=_a,je=Fa;return v(),V(oa,{modelValue:Ae.value,"onUpdate:modelValue":g[10]||(g[10]=$=>Ae.value=$),title:"车队管理中心",direction:"rtl",size:"80%","with-header":!0,"before-close":m,"destroy-on-close":!1,"size-drag":!0,class:"fleet-drawer"},{default:u(()=>[h("div",Bt,[h("div",Rt,[g[12]||(g[12]=h("h2",null,"车队数据分析中心",-1)),e(N,{onClick:y,type:"primary",size:"small"},{default:u(()=>g[11]||(g[11]=[De("返回主页")])),_:1})]),e(Xe,{modelValue:ze.value,"onUpdate:modelValue":g[9]||(g[9]=$=>ze.value=$),type:"card"},{default:u(()=>[e(Me,{label:"车队运输记录",name:"records"},{default:u(()=>[h("div",Wt,[e(I,{modelValue:oe.value,"onUpdate:modelValue":g[0]||(g[0]=$=>oe.value=$),placeholder:"输入关键词查询车队信息",clearable:"",style:{width:"300px","margin-right":"15px"},onClear:R,onKeyup:ca($e,["enter"])},null,8,["modelValue"]),h("div",Nt,[e(z,{modelValue:ve.value,"onUpdate:modelValue":g[1]||(g[1]=$=>ve.value=$),placeholder:"选择年份",clearable:"",onChange:W,style:{width:"120px","margin-right":"10px"}},{default:u(()=>[(v(!0),O(q,null,H(ee.value,$=>(v(),V(pe,{key:$,label:$+"年",value:$},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e(z,{modelValue:Y.value,"onUpdate:modelValue":g[2]||(g[2]=$=>Y.value=$),placeholder:"选择月份",clearable:"",disabled:!ve.value,onChange:X,style:{width:"120px","margin-right":"10px"}},{default:u(()=>[(v(!0),O(q,null,H(se.value,$=>(v(),V(pe,{key:$,label:$+"月",value:$},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"]),e(z,{modelValue:j.value,"onUpdate:modelValue":g[3]||(g[3]=$=>j.value=$),placeholder:"选择日期",clearable:"",disabled:!Y.value,onChange:be,style:{width:"120px","margin-right":"10px"}},{default:u(()=>[(v(!0),O(q,null,H(me.value,$=>(v(),V(pe,{key:$,label:$+"日",value:$},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"]),e(N,{onClick:Oe},{default:u(()=>g[13]||(g[13]=[De("重置")])),_:1})])]),Ce.value?(v(),V(K,{key:0,title:Fe.value,type:"error",closable:!1,"show-icon":"",style:{"margin-bottom":"15px"}},null,8,["title"])):ka("",!0),aa((v(),V(ta,{data:ke.value,border:"",style:{width:"100%"},height:"500"},{empty:u(()=>[e(we,{description:"暂无数据"})]),default:u(()=>[e(re,{prop:"id",label:"ID",width:"80"}),e(re,{prop:"dock_out_year",label:"年份",width:"80"}),e(re,{prop:"dock_out_month",label:"月份",width:"80"}),e(re,{prop:"dock_out_day",label:"日期",width:"80"}),e(re,{prop:"dock_out_hour",label:"小时",width:"80"}),e(re,{prop:"dock_out_time",label:"出发时间",width:"180"}),e(re,{prop:"dock_out_fleet",label:"车队编号",width:"150"}),e(re,{prop:"dock_out_company",label:"所属公司",width:"200"}),e(re,{prop:"dock_out_name",label:"运输货物",width:"120"}),e(re,{prop:"dock_out_type",label:"货物类型",width:"120"}),e(re,{label:"重量(吨)",width:"100"},{default:u($=>[De(Ve($.row.dock_out_weight?$.row.dock_out_weight.toFixed(2):"0.00"),1)]),_:1}),e(re,{prop:"dock_out_other",label:"备注","min-width":"120"})]),_:1},8,["data"])),[[je,G.value]]),h("div",Yt,[e(Ge,{"current-page":te.value,"onUpdate:currentPage":g[4]||(g[4]=$=>te.value=$),"page-size":ae.value,"onUpdate:pageSize":g[5]||(g[5]=$=>ae.value=$),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:D.value.length,onSizeChange:xe,onCurrentChange:ye},null,8,["current-page","page-size","total"])])]),_:1}),e(Me,{label:"车队分析图表",name:"charts"},{default:u(()=>[h("div",jt,[h("div",qt,[h("div",Ht,[e(z,{modelValue:E.value,"onUpdate:modelValue":g[6]||(g[6]=$=>E.value=$),placeholder:"选择年份",clearable:"",onChange:Ye,style:{width:"120px","margin-right":"10px"}},{default:u(()=>[(v(!0),O(q,null,H(ee.value,$=>(v(),V(pe,{key:$,label:$+"年",value:$},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e(z,{modelValue:U.value,"onUpdate:modelValue":g[7]||(g[7]=$=>U.value=$),placeholder:"选择月份",clearable:"",disabled:!E.value,onChange:Pe,style:{width:"120px","margin-right":"10px"}},{default:u(()=>[(v(!0),O(q,null,H(se.value,$=>(v(),V(pe,{key:$,label:$+"月",value:$},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"]),e(z,{modelValue:M.value,"onUpdate:modelValue":g[8]||(g[8]=$=>M.value=$),placeholder:"选择日期",clearable:"",disabled:!U.value,onChange:Se,style:{width:"120px"}},{default:u(()=>[(v(!0),O(q,null,H(me.value,$=>(v(),V(pe,{key:$,label:$+"日",value:$},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])])]),h("div",Qt,[h("div",{ref_key:"transportVolumeChart",ref:J,style:{width:"100%",height:"600px"}},null,512)])])]),_:1}),e(Me,{label:"车队信息管理",name:"manage"},{default:u(()=>g[14]||(g[14]=[h("div",{class:"manage-container"},[h("h3",null,"车队信息管理功能开发中...")],-1)])),_:1})]),_:1},8,["modelValue"])])]),_:1},8,["modelValue"])}}},no=pa(Kt,[["__scopeId","data-v-a849f4ce"]]),Gt={class:"drawer-content"},Xt={class:"header"},Jt={class:"filter-container"},Zt={class:"filter-container"},el={class:"filter-container"},al={class:"filter-container"},tl={class:"filter-container"},ll={class:"chart-container"},ol={class:"chart-wrapper"},rl={class:"pie-charts-container"},nl={class:"chart-wrapper pie-chart"},sl={class:"chart-wrapper pie-chart"},ul={__name:"DockCenter",props:{modelValue:{type:Boolean,required:!0,default:!1}},emits:["update:modelValue"],setup(We,{emit:Ne}){const Ae=We,ze=Ne,G=P({get:()=>Ae.modelValue,set:l=>ze("update:modelValue",l)}),Ce=()=>{ze("update:modelValue",!1)},Fe=l=>{console.log("关闭码头管理抽屉"),l()},L=t("info"),oe=t("catch"),te=t({docks:!1,catches:!1,trans:!1,direct:!1}),ae=t([]),ee=t(""),se=t(1),me=t(20),ve=t(!1),Y=t([]),j=t(""),E=t(1),U=t(20),M=t(!1),J=t(""),A=t(""),_e=t(""),ce=t(""),y=t([]),m=t(""),C=t(1),D=t(20),ke=t(!1),xe=t(""),ye=t(""),$e=t(""),R=t(""),W=t([]),X=t(""),be=t(1),Oe=t(20),Ye=t(!1),Pe=t(""),Se=t(""),Le=t(""),ue=t(""),ne=t(""),fe=t(""),b=t("");let g=null,N=null,I=null;const pe=t(null),z=t(null),K=t(null),we=P(()=>{if(!ee.value)return ae.value;const l=ee.value.toLowerCase();return ae.value.filter(o=>Object.keys(o).some(de=>{const ge=o[de];return ge!=null&&String(ge).toLowerCase().includes(l)}))}),re=P(()=>{const l=(se.value-1)*me.value,o=l+me.value;return we.value.slice(l,o)}),ta=P(()=>[...new Set(Y.value.map(l=>l.catch_dock))].sort()),Ge=P(()=>{let l=Y.value;if(j.value){const o=j.value.toLowerCase();l=l.filter(de=>Object.keys(de).some(ge=>{const S=de[ge];return S!=null&&String(S).toLowerCase().includes(o)}))}return J.value&&(l=l.filter(o=>o.catch_year==J.value),A.value&&(l=l.filter(o=>o.catch_month==A.value),_e.value&&(l=l.filter(o=>o.catch_day==_e.value)))),ce.value&&(l=l.filter(o=>o.catch_dock===ce.value)),l}),Me=P(()=>{const l=(E.value-1)*U.value,o=l+U.value;return Ge.value.slice(l,o)}),Xe=P(()=>{let l=y.value;if(m.value){const o=m.value.toLowerCase();l=l.filter(de=>Object.keys(de).some(ge=>{const S=de[ge];return S!=null&&String(S).toLowerCase().includes(o)}))}return xe.value&&(l=l.filter(o=>o.dock_out_year==xe.value),ye.value&&(l=l.filter(o=>o.dock_out_month==ye.value),$e.value&&(l=l.filter(o=>o.dock_out_day==$e.value)))),R.value&&(l=l.filter(o=>o.dock_out_company===R.value)),l}),oa=P(()=>{const l=(C.value-1)*D.value,o=l+D.value;return Xe.value.slice(l,o)}),je=P(()=>[...new Set(y.value.map(l=>l.dock_out_company))].sort()),$=P(()=>{let l=W.value;if(X.value){const o=X.value.toLowerCase();l=l.filter(de=>Object.keys(de).some(ge=>{const S=de[ge];return S!=null&&String(S).toLowerCase().includes(o)}))}return Pe.value&&(l=l.filter(o=>o.dock_out_year==Pe.value),Se.value&&(l=l.filter(o=>o.dock_out_month==Se.value),Le.value&&(l=l.filter(o=>o.dock_out_day==Le.value)))),l}),la=P(()=>{const l=(be.value-1)*Oe.value,o=l+Oe.value;return $.value.slice(l,o)}),na=P(()=>[...new Set(Y.value.map(l=>l.catch_year))].sort()),sa=P(()=>J.value?[...new Set(Y.value.filter(l=>l.catch_year==J.value).map(l=>l.catch_month))].sort((l,o)=>l-o):[]),da=P(()=>!J.value||!A.value?[]:[...new Set(Y.value.filter(l=>l.catch_year==J.value&&l.catch_month==A.value).map(l=>l.catch_day))].sort((l,o)=>l-o)),_=P(()=>[...new Set(y.value.map(l=>l.dock_out_year))].sort()),a=P(()=>xe.value?[...new Set(y.value.filter(l=>l.dock_out_year==xe.value).map(l=>l.dock_out_month))].sort((l,o)=>l-o):[]),n=P(()=>!xe.value||!ye.value?[]:[...new Set(y.value.filter(l=>l.dock_out_year==xe.value&&l.dock_out_month==ye.value).map(l=>l.dock_out_day))].sort((l,o)=>l-o)),s=P(()=>[...new Set(W.value.map(l=>l.dock_out_year))].sort()),F=P(()=>Pe.value?[...new Set(W.value.filter(l=>l.dock_out_year==Pe.value).map(l=>l.dock_out_month))].sort((l,o)=>l-o):[]),B=P(()=>!Pe.value||!Se.value?[]:[...new Set(W.value.filter(l=>l.dock_out_year==Pe.value&&l.dock_out_month==Se.value).map(l=>l.dock_out_day))].sort((l,o)=>l-o)),T=P(()=>[...new Set(y.value.map(l=>l.dock_out_year))].sort()),he=P(()=>ue.value?[...new Set(y.value.filter(l=>l.dock_out_year==ue.value).map(l=>l.dock_out_month))].sort((l,o)=>l-o):[]),Q=P(()=>!ue.value||!ne.value?[]:[...new Set(y.value.filter(l=>l.dock_out_year==ue.value&&l.dock_out_month==ne.value).map(l=>l.dock_out_day))].sort((l,o)=>l-o)),p=async()=>{if(!te.value.docks){ve.value=!0;try{const l=await Re.get("http://localhost:8080/dock");ae.value=l.data||[],te.value.docks=!0}catch(l){console.error("获取码头数据失败:",l)}finally{ve.value=!1}}},r=async()=>{if(!te.value.catches){M.value=!0;try{const l=await Re.get("http://localhost:8080/catch");Y.value=l.data||[],te.value.catches=!0}catch(l){console.error("获取捕捞记录失败:",l)}finally{M.value=!1}}},k=async()=>{if(!te.value.trans){ke.value=!0;try{const l=await Re.get("http://localhost:8080/trans");y.value=l.data||[],te.value.trans=!0,y.value.length>0&&tt()}catch(l){console.error("获取车运出港数据失败:",l)}finally{ke.value=!1}}},c=async()=>{if(!te.value.direct){Ye.value=!0;try{const l=await Re.get("http://localhost:8080/direct");W.value=l.data||[],te.value.direct=!0}catch(l){console.error("获取直销出港数据失败:",l)}finally{Ye.value=!1}}},d=()=>{se.value=1},f=()=>{ee.value="",se.value=1},x=()=>{E.value=1},ie=()=>{j.value="",E.value=1},Te=()=>{A.value="",_e.value="",E.value=1},Aa=()=>{_e.value="",E.value=1},ya=()=>{E.value=1},ra=()=>{E.value=1},ba=()=>{C.value=1},va=()=>{m.value="",C.value=1},ha=()=>{ye.value="",$e.value="",C.value=1},Oa=()=>{$e.value="",C.value=1},Ta=()=>{C.value=1},w=()=>{C.value=1},qa=()=>{be.value=1},Ha=()=>{X.value="",be.value=1},Qa=()=>{Se.value="",Le.value="",be.value=1},Ka=()=>{Le.value="",be.value=1},Ga=()=>{be.value=1},Xa=()=>{ne.value="",fe.value="",wa()},Ja=()=>{fe.value="",wa()},Za=()=>{wa()},et=()=>{Ma()},Ea=()=>{if(console.log("Initializing charts..."),console.log("Chart refs:",pe.value,z.value,K.value),!pe.value||!z.value||!K.value){console.error("Chart container elements not found"),Ke(()=>{pe.value&&z.value&&K.value&&(console.log("Retrying chart initialization..."),Ea())});return}try{g&&g.dispose(),N&&N.dispose(),I&&I.dispose(),g=Be(pe.value),N=Be(z.value),I=Be(K.value),console.log("Charts initialized successfully:",g,N,I),wa(),window.addEventListener("resize",Wa)}catch(l){console.error("Error initializing charts:",l)}},wa=()=>{console.log("Updating charts with data..."),at(),Ma()},at=()=>{if(!g||!N)return;let l=[...y.value];ue.value&&(l=l.filter(le=>le.dock_out_year==ue.value),ne.value&&(l=l.filter(le=>le.dock_out_month==ne.value),fe.value&&(l=l.filter(le=>le.dock_out_day==fe.value))));let o="year",de=[];if(ue.value&&!ne.value)o="month",de=Array.from({length:12},(le,He)=>He+1);else if(ue.value&&ne.value&&!fe.value){o="day";const le=new Date(ue.value,ne.value,0).getDate();de=Array.from({length:le},(He,i)=>i+1)}else ue.value&&ne.value&&fe.value?(o="hour",de=Array.from({length:24},(le,He)=>He)):(o="year",de=[...new Set(y.value.map(le=>le.dock_out_year))].sort());const ge=[],S=[...new Set(l.map(le=>le.dock_out_company))];S.forEach(le=>{const i=l.filter(ua=>ua.dock_out_company===le).reduce((ua,Ze)=>ua+Number(Ze.dock_out_weight||0),0);ge.push({name:le,value:parseFloat(i.toFixed(2))})});const Ie=[];S.forEach((le,He)=>{const i=[];for(const ua of de){let Ze=l.filter(ea=>ea.dock_out_company===le);o==="month"?Ze=Ze.filter(ea=>ea.dock_out_month==ua):o==="day"?Ze=Ze.filter(ea=>ea.dock_out_day==ua):o==="hour"?Ze=Ze.filter(ea=>ea.dock_out_hour==ua):o==="year"&&(Ze=Ze.filter(ea=>ea.dock_out_year==ua));const lt=Ze.reduce((ea,ot)=>ea+Number(ot.dock_out_weight||0),0);i.push(parseFloat(lt.toFixed(2)))}Ie.push({name:le,type:"line",stack:"Total",smooth:!0,lineStyle:{width:3},areaStyle:{opacity:.8},emphasis:{focus:"series"},data:i})});let qe=de;o==="month"?qe=de.map(le=>`${le}月`):o==="day"?qe=de.map(le=>`${le}日`):o==="hour"?qe=de.map(le=>`${le}时`):o==="year"&&(qe=de.map(le=>`${le}年`));const Je=["#FF6B6B","#4BC0C0","#9966FF","#FFCE56","#36A2EB","#FF9F40","#2ECC71","#F653A6","#7C4DFF","#5AD8A6","#FF8A80","#64B5F6"];let Z="";ue.value?(Z=`${ue.value}年`,ne.value&&(Z+=`${ne.value}月`,fe.value&&(Z+=`${fe.value}日`))):Z="全部时间";const Ue={color:Je,title:{text:`${Z}公司运输量统计`,left:"center",textStyle:{fontSize:18,fontWeight:"bold"}},tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}}},legend:{data:S,top:"40px"},grid:{left:"3%",right:"4%",bottom:"3%",top:"80px",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:qe,axisLabel:{interval:0,rotate:qe.length>12?45:0,fontSize:12}},yAxis:{type:"value",name:"运输量(公斤)",nameTextStyle:{fontSize:14,padding:[0,0,0,40]}},series:Ie},fa={color:Je,title:{text:`${Z}公司运输量比例`,left:"center",textStyle:{fontSize:18,fontWeight:"bold"}},tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} 公斤 ({d}%)"},legend:{orient:"vertical",left:"left",top:"middle",data:ge.map(le=>le.name)},series:[{name:"公司运输量",type:"pie",radius:["40%","70%"],center:["60%","50%"],avoidLabelOverlap:!1,itemStyle:{borderRadius:10,borderColor:"#fff",borderWidth:2},label:{show:!0,formatter:"{b}: {c} 公斤"},emphasis:{label:{show:!0,fontSize:16,fontWeight:"bold"},itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}},data:ge.length>0?ge:[{name:"暂无数据",value:1}]}]};g.setOption(Ue,!0),N.setOption(fa,!0)},Ma=()=>{if(!I)return;let l=[...y.value];ue.value&&(l=l.filter(Z=>Z.dock_out_year==ue.value),ne.value&&(l=l.filter(Z=>Z.dock_out_month==ne.value),fe.value&&(l=l.filter(Z=>Z.dock_out_day==fe.value))));let o=[],de=l;b.value&&(de=l.filter(Z=>Z.dock_out_company===b.value)),o=[...new Set(de.map(Z=>Z.dock_out_type))].map(Z=>{const fa=de.filter(le=>le.dock_out_type===Z).reduce((le,He)=>le+Number(He.dock_out_weight||0),0);return{name:Z,value:parseFloat(fa.toFixed(2))}}).filter(Z=>Z.value>0);const S=["#FF6B6B","#4BC0C0","#9966FF","#FFCE56","#36A2EB","#FF9F40","#2ECC71","#F653A6","#7C4DFF","#5AD8A6","#FF8A80","#64B5F6"];let Ie="";ue.value?(Ie=`${ue.value}年`,ne.value&&(Ie+=`${ne.value}月`,fe.value&&(Ie+=`${fe.value}日`))):Ie="全部时间";const qe=b.value?`${Ie} ${b.value} 产品运输量比例`:`${Ie}所有公司产品运输量比例`,Je={color:S,title:{text:qe,left:"center",textStyle:{fontSize:18,fontWeight:"bold"}},tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} 公斤 ({d}%)"},legend:{orient:"vertical",left:"left",top:"middle",data:o.map(Z=>Z.name)},series:[{name:"产品运输量",type:"pie",radius:["40%","70%"],center:["60%","50%"],avoidLabelOverlap:!1,itemStyle:{borderRadius:10,borderColor:"#fff",borderWidth:2},label:{show:!0,formatter:"{b}: {c} 公斤"},emphasis:{label:{show:!0,fontSize:16,fontWeight:"bold"},itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}},data:o.length>0?o:[{name:"暂无数据",value:1}]}]};I.setOption(Je,!0)},tt=()=>{if(y.value&&y.value.length>0){const o=[...y.value].sort((de,ge)=>{const S=new Date(de.dock_out_year,de.dock_out_month-1,de.dock_out_day);return new Date(ge.dock_out_year,ge.dock_out_month-1,ge.dock_out_day)-S})[0];ue.value=o.dock_out_year,ne.value=o.dock_out_month,fe.value=o.dock_out_day,console.log(`Set default date to: ${ue.value}-${ne.value}-${fe.value}`)}};Qe(G,l=>{l&&(p(),r(),k(),c(),Ke(()=>{setTimeout(()=>{L.value==="analysis"&&Ea()},500)}))}),Qe(L,l=>{l==="analysis"&&Ke(()=>{setTimeout(()=>{Ea()},500)})}),Qe([ue,ne,fe],()=>{L.value==="analysis"&&wa()}),Qe(b,()=>{L.value==="analysis"&&Ma()});const Wa=()=>{g&&G.value&&g.resize(),N&&G.value&&N.resize(),I&&G.value&&I.resize()};return Sa(()=>{g&&(g.dispose(),g=null),N&&(N.dispose(),N=null),I&&(I.dispose(),I=null),window.removeEventListener("resize",Wa)}),xa(()=>{L.value="info",oe.value="catch"}),(l,o)=>{const de=Da,ge=Va,S=za,Ie=$a,qe=Pa,Je=ga,Z=Ua,Ue=La,fa=ma,le=_a,He=Fa;return v(),V(le,{modelValue:G.value,"onUpdate:modelValue":o[29]||(o[29]=i=>G.value=i),title:"码头管理中心",direction:"rtl",size:"90%","with-header":!0,"before-close":Fe,"destroy-on-close":!1,"size-drag":!0,class:"dock-drawer"},{default:u(()=>[h("div",Gt,[h("div",Xt,[o[31]||(o[31]=h("h2",null,"码头数据分析中心",-1)),e(de,{onClick:Ce,type:"primary",size:"small"},{default:u(()=>o[30]||(o[30]=[De("返回主页")])),_:1})]),e(fa,{modelValue:L.value,"onUpdate:modelValue":o[28]||(o[28]=i=>L.value=i),type:"card"},{default:u(()=>[e(Je,{label:"码头详情",name:"info"},{default:u(()=>[h("div",Jt,[e(ge,{modelValue:ee.value,"onUpdate:modelValue":o[0]||(o[0]=i=>ee.value=i),placeholder:"输入关键词查询码头信息",clearable:"",style:{width:"300px","margin-right":"15px"},onClear:f,onKeyup:ca(d,["enter"])},null,8,["modelValue"])]),aa((v(),V(Ie,{data:re.value,border:"",style:{width:"100%"},height:"500"},{default:u(()=>[e(S,{prop:"dock_name",label:"码头名称",width:"150"}),e(S,{prop:"dock_loca",label:"码头位置",width:"200"}),e(S,{prop:"dock_berths",label:"泊位数",width:"100"}),e(S,{prop:"dock_line",label:"岸线长度(米)",width:"120"}),e(S,{prop:"dock_deep",label:"水深(米)",width:"100"}),e(S,{prop:"dock_equip",label:"设施配置"}),e(S,{prop:"dock_area",label:"占地面积(㎡)",width:"120"}),e(S,{prop:"dock_capa",label:"年吞吐量(吨)",width:"120"}),e(S,{prop:"dock_state",label:"运营状态",width:"100"}),e(S,{prop:"dock_tel",label:"联系电话",width:"150"})]),_:1},8,["data"])),[[He,ve.value]]),e(qe,{"current-page":se.value,"page-size":me.value,total:we.value.length,layout:"total, sizes, prev, pager, next, jumper","page-sizes":[10,20,50,100],"onUpdate:currentPage":o[1]||(o[1]=i=>se.value=i),"onUpdate:pageSize":o[2]||(o[2]=i=>me.value=i)},null,8,["current-page","page-size","total"])]),_:1}),e(Je,{label:"出入港记录",name:"records"},{default:u(()=>[e(fa,{modelValue:oe.value,"onUpdate:modelValue":o[23]||(o[23]=i=>oe.value=i),type:"border-card"},{default:u(()=>[e(Je,{label:"捕捞记录",name:"catch"},{default:u(()=>[h("div",Zt,[e(ge,{modelValue:j.value,"onUpdate:modelValue":o[3]||(o[3]=i=>j.value=i),placeholder:"输入关键词查询捕捞记录",clearable:"",style:{width:"300px","margin-right":"15px"},onClear:ie,onKeyup:ca(x,["enter"])},null,8,["modelValue"]),e(Ue,{modelValue:J.value,"onUpdate:modelValue":o[4]||(o[4]=i=>J.value=i),placeholder:"选择年份",clearable:"",style:{width:"150px","margin-right":"15px"},onChange:Te},{default:u(()=>[(v(!0),O(q,null,H(na.value,i=>(v(),V(Z,{key:i,label:`${i}年`,value:i},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e(Ue,{modelValue:A.value,"onUpdate:modelValue":o[5]||(o[5]=i=>A.value=i),placeholder:"选择月份",clearable:"",disabled:!J.value,style:{width:"150px","margin-right":"15px"},onChange:Aa},{default:u(()=>[(v(!0),O(q,null,H(sa.value,i=>(v(),V(Z,{key:i,label:`${i}月`,value:i},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"]),e(Ue,{modelValue:_e.value,"onUpdate:modelValue":o[6]||(o[6]=i=>_e.value=i),placeholder:"选择日期",clearable:"",disabled:!A.value,style:{width:"150px","margin-right":"15px"},onChange:ya},{default:u(()=>[(v(!0),O(q,null,H(da.value,i=>(v(),V(Z,{key:i,label:`${i}日`,value:i},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"]),e(Ue,{modelValue:ce.value,"onUpdate:modelValue":o[7]||(o[7]=i=>ce.value=i),placeholder:"选择码头",clearable:"",style:{width:"200px"},onChange:ra},{default:u(()=>[(v(!0),O(q,null,H(ta.value,i=>(v(),V(Z,{key:i,label:i,value:i},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),aa((v(),V(Ie,{data:Me.value,border:"",style:{width:"100%"},height:"500"},{default:u(()=>[e(S,{prop:"catch_fishery",label:"渔场",width:"120"}),e(S,{prop:"catch_ship",label:"渔船编号",width:"120"}),e(S,{prop:"catch_dock",label:"停靠码头",width:"150"}),e(S,{prop:"catch_company",label:"所属公司",width:"200"}),e(S,{prop:"catch_year",label:"年",width:"80"}),e(S,{prop:"catch_month",label:"月",width:"80"}),e(S,{prop:"catch_day",label:"日",width:"80"}),e(S,{prop:"catch_hour",label:"时",width:"80"}),e(S,{prop:"catch_type",label:"海产类别",width:"120"}),e(S,{prop:"catch_name",label:"海产名称",width:"120"}),e(S,{prop:"catch_weight",label:"重量(公斤)",width:"120"}),e(S,{prop:"catch_date",label:"捕捞日期",width:"120"}),e(S,{prop:"catch_time",label:"捕捞时间",width:"140"})]),_:1},8,["data"])),[[He,M.value]]),e(qe,{"current-page":E.value,"page-size":U.value,total:Ge.value.length,layout:"total, sizes, prev, pager, next, jumper","page-sizes":[10,20,50,100],"onUpdate:currentPage":o[8]||(o[8]=i=>E.value=i),"onUpdate:pageSize":o[9]||(o[9]=i=>U.value=i)},null,8,["current-page","page-size","total"])]),_:1}),e(Je,{label:"车运出港",name:"trans"},{default:u(()=>[h("div",el,[e(ge,{modelValue:m.value,"onUpdate:modelValue":o[10]||(o[10]=i=>m.value=i),placeholder:"输入关键词查询车运记录",clearable:"",style:{width:"300px","margin-right":"15px"},onClear:va,onKeyup:ca(ba,["enter"])},null,8,["modelValue"]),e(Ue,{modelValue:xe.value,"onUpdate:modelValue":o[11]||(o[11]=i=>xe.value=i),placeholder:"选择年份",clearable:"",style:{width:"150px","margin-right":"15px"},onChange:ha},{default:u(()=>[(v(!0),O(q,null,H(_.value,i=>(v(),V(Z,{key:i,label:`${i}年`,value:i},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e(Ue,{modelValue:ye.value,"onUpdate:modelValue":o[12]||(o[12]=i=>ye.value=i),placeholder:"选择月份",clearable:"",disabled:!xe.value,style:{width:"150px","margin-right":"15px"},onChange:Oa},{default:u(()=>[(v(!0),O(q,null,H(a.value,i=>(v(),V(Z,{key:i,label:`${i}月`,value:i},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"]),e(Ue,{modelValue:$e.value,"onUpdate:modelValue":o[13]||(o[13]=i=>$e.value=i),placeholder:"选择日期",clearable:"",disabled:!ye.value,style:{width:"150px","margin-right":"15px"},onChange:Ta},{default:u(()=>[(v(!0),O(q,null,H(n.value,i=>(v(),V(Z,{key:i,label:`${i}日`,value:i},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"]),e(Ue,{modelValue:R.value,"onUpdate:modelValue":o[14]||(o[14]=i=>R.value=i),placeholder:"选择物流公司",clearable:"",style:{width:"200px"},onChange:w},{default:u(()=>[(v(!0),O(q,null,H(je.value,i=>(v(),V(Z,{key:i,label:i,value:i},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),aa((v(),V(Ie,{data:oa.value,border:"",style:{width:"100%"},height:"500"},{default:u(()=>[e(S,{prop:"dock_out_year",label:"年",width:"80"}),e(S,{prop:"dock_out_month",label:"月",width:"80"}),e(S,{prop:"dock_out_day",label:"日",width:"80"}),e(S,{prop:"dock_out_hour",label:"时",width:"80"}),e(S,{prop:"dock_out_time",label:"出港日期",width:"120"}),e(S,{prop:"dock_out_fleet",label:"车队编号",width:"150"}),e(S,{prop:"dock_out_company",label:"物流公司",width:"200"}),e(S,{prop:"dock_out_name",label:"产品名称",width:"120"}),e(S,{prop:"dock_out_type",label:"产品类型",width:"120"}),e(S,{prop:"dock_out_weight",label:"重量(公斤)",width:"120"}),e(S,{prop:"dock_out_other",label:"备注"})]),_:1},8,["data"])),[[He,ke.value]]),e(qe,{"current-page":C.value,"page-size":D.value,total:Xe.value.length,layout:"total, sizes, prev, pager, next, jumper","page-sizes":[10,20,50,100],"onUpdate:currentPage":o[15]||(o[15]=i=>C.value=i),"onUpdate:pageSize":o[16]||(o[16]=i=>D.value=i)},null,8,["current-page","page-size","total"])]),_:1}),e(Je,{label:"直销出港",name:"direct"},{default:u(()=>[h("div",al,[e(ge,{modelValue:X.value,"onUpdate:modelValue":o[17]||(o[17]=i=>X.value=i),placeholder:"输入关键词查询直销记录",clearable:"",style:{width:"300px","margin-right":"15px"},onClear:Ha,onKeyup:ca(qa,["enter"])},null,8,["modelValue"]),e(Ue,{modelValue:Pe.value,"onUpdate:modelValue":o[18]||(o[18]=i=>Pe.value=i),placeholder:"选择年份",clearable:"",style:{width:"150px","margin-right":"15px"},onChange:Qa},{default:u(()=>[(v(!0),O(q,null,H(s.value,i=>(v(),V(Z,{key:i,label:`${i}年`,value:i},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e(Ue,{modelValue:Se.value,"onUpdate:modelValue":o[19]||(o[19]=i=>Se.value=i),placeholder:"选择月份",clearable:"",disabled:!Pe.value,style:{width:"150px","margin-right":"15px"},onChange:Ka},{default:u(()=>[(v(!0),O(q,null,H(F.value,i=>(v(),V(Z,{key:i,label:`${i}月`,value:i},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"]),e(Ue,{modelValue:Le.value,"onUpdate:modelValue":o[20]||(o[20]=i=>Le.value=i),placeholder:"选择日期",clearable:"",disabled:!Se.value,style:{width:"150px"},onChange:Ga},{default:u(()=>[(v(!0),O(q,null,H(B.value,i=>(v(),V(Z,{key:i,label:`${i}日`,value:i},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),aa((v(),V(Ie,{data:la.value,border:"",style:{width:"100%"},height:"500"},{default:u(()=>[e(S,{prop:"dock_out_year",label:"年",width:"80"}),e(S,{prop:"dock_out_month",label:"月",width:"80"}),e(S,{prop:"dock_out_day",label:"日",width:"80"}),e(S,{prop:"dock_out_hour",label:"时",width:"80"}),e(S,{prop:"dock_out_time",label:"出港日期",width:"120"}),e(S,{prop:"dock_out_name",label:"产品名称",width:"120"}),e(S,{prop:"dock_out_type",label:"产品类型",width:"120"}),e(S,{prop:"dock_out_weight",label:"重量(公斤)",width:"120"}),e(S,{prop:"dock_out_buyinfo",label:"购买信息"})]),_:1},8,["data"])),[[He,Ye.value]]),e(qe,{"current-page":be.value,"page-size":Oe.value,total:$.value.length,layout:"total, sizes, prev, pager, next, jumper","page-sizes":[10,20,50,100],"onUpdate:currentPage":o[21]||(o[21]=i=>be.value=i),"onUpdate:pageSize":o[22]||(o[22]=i=>Oe.value=i)},null,8,["current-page","page-size","total"])]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(Je,{label:"码头分析",name:"analysis"},{default:u(()=>[h("div",tl,[e(Ue,{modelValue:ue.value,"onUpdate:modelValue":o[24]||(o[24]=i=>ue.value=i),placeholder:"选择年份",clearable:"",style:{width:"150px","margin-right":"15px"},onChange:Xa},{default:u(()=>[(v(!0),O(q,null,H(T.value,i=>(v(),V(Z,{key:i,label:`${i}年`,value:i},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e(Ue,{modelValue:ne.value,"onUpdate:modelValue":o[25]||(o[25]=i=>ne.value=i),placeholder:"选择月份",clearable:"",disabled:!ue.value,style:{width:"150px","margin-right":"15px"},onChange:Ja},{default:u(()=>[(v(!0),O(q,null,H(he.value,i=>(v(),V(Z,{key:i,label:`${i}月`,value:i},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"]),e(Ue,{modelValue:fe.value,"onUpdate:modelValue":o[26]||(o[26]=i=>fe.value=i),placeholder:"选择日期",clearable:"",disabled:!ne.value,style:{width:"150px","margin-right":"15px"},onChange:Za},{default:u(()=>[(v(!0),O(q,null,H(Q.value,i=>(v(),V(Z,{key:i,label:`${i}日`,value:i},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"]),e(Ue,{modelValue:b.value,"onUpdate:modelValue":o[27]||(o[27]=i=>b.value=i),placeholder:"选择公司(产品饼图)",clearable:"",style:{width:"250px"},onChange:et},{default:u(()=>[(v(!0),O(q,null,H(je.value,i=>(v(),V(Z,{key:i,label:i,value:i},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),h("div",ll,[h("div",ol,[o[32]||(o[32]=h("div",{class:"chart-title"},"公司运输量统计",-1)),h("div",{ref_key:"areaChartRef",ref:pe,style:{width:"140vh",height:"500px"}},null,512)]),h("div",rl,[h("div",nl,[o[33]||(o[33]=h("div",{class:"chart-title"},"公司运输量比例",-1)),h("div",{ref_key:"companyPieRef",ref:z,style:{width:"100%",height:"400px"}},null,512)]),h("div",sl,[o[34]||(o[34]=h("div",{class:"chart-title"},"产品运输量比例",-1)),h("div",{ref_key:"productPieRef",ref:K,style:{width:"100%",height:"400px"}},null,512)])])])]),_:1})]),_:1},8,["modelValue"])])]),_:1},8,["modelValue"])}}},so=pa(ul,[["__scopeId","data-v-e74b4f5a"]]),il={class:"drawer-content"},dl={class:"header"},cl={class:"filter-container"},pl={class:"filter-container"},vl={class:"filter-container"},hl={class:"chart-container"},fl={class:"chart-wrapper"},_l={class:"pie-charts-container"},ml={class:"chart-wrapper pie-chart"},gl={class:"chart-wrapper pie-chart"},yl={__name:"ShipCenter",props:{modelValue:{type:Boolean,required:!0,default:!1}},emits:["update:modelValue"],setup(We,{emit:Ne}){const Ae=We,ze=Ne,G=P({get:()=>Ae.modelValue,set:_=>ze("update:modelValue",_)}),Ce=()=>{ze("update:modelValue",!1)},Fe=_=>{console.log("关闭抽屉"),_()},L=t(["中国水产舟山海洋渔业有限公司","舟山广龙船务有限公司","舟山海盈船务有限公司","舟山市南海宝庆船务有限公司","舟山军华船务有限公司"]),oe=t("info"),te=t(!0),ae=t({ships:!1,catches:!1,charts:!1}),ee=t(""),se=t(""),me=t(1),ve=t(20),Y=t(!1),j=t([]),E=t(""),U=t(""),M=t(""),J=t(""),A=t(1),_e=t(20),ce=t(!1),y=t([]),m=t(""),C=t(""),D=t(""),ke=t(""),xe=t(null),ye=t(null),$e=t(null);let R=null,W=null,X=null;const be=t(!1),Oe=P(()=>[...new Set(y.value.map(_=>_.catch_year))].sort()),Ye=P(()=>m.value?[...new Set(y.value.filter(_=>_.catch_year==m.value).map(_=>_.catch_month))].sort((_,a)=>_-a):[]),Pe=P(()=>!m.value||!C.value?[]:[...new Set(y.value.filter(_=>_.catch_year==m.value&&_.catch_month==C.value).map(_=>_.catch_day))].sort((_,a)=>_-a)),Se=P(()=>[...new Set(y.value.map(_=>_.catch_year))].sort()),Le=P(()=>U.value?[...new Set(y.value.filter(_=>_.catch_year==U.value).map(_=>_.catch_month))].sort((_,a)=>_-a):[]),ue=P(()=>!U.value||!M.value?[]:[...new Set(y.value.filter(_=>_.catch_year==U.value&&_.catch_month==M.value).map(_=>_.catch_day))].sort((_,a)=>_-a));Qe(()=>G.value,_=>{_&&(console.log("抽屉打开，预加载数据"),ne())},{immediate:!0});const ne=async()=>{te.value&&(console.log("首次加载，预加载所有标签页数据"),Promise.all([fe(),b()]).then(()=>{console.log("所有数据加载完成"),te.value=!1,Ke(()=>{oe.value==="analysis"&&$()})}).catch(_=>{console.error("预加载数据出错:",_),alert("数据加载失败，请重试")}))},fe=async()=>{if(ae.value.ships)return console.log("渔船数据已加载，跳过"),Promise.resolve();Y.value=!0,console.log("开始加载渔船数据");try{const _=await Re.get("http://localhost:8080/ship");return j.value=_.data,console.log(`获取到${j.value.length}条渔船数据`),ae.value.ships=!0,Promise.resolve()}catch(_){return console.error("获取渔船数据失败:",_),Promise.reject(_)}finally{Y.value=!1}},b=async()=>{if(ae.value.catches)return console.log("捕捞记录已加载，跳过"),Promise.resolve();ce.value=!0,console.log("开始加载捕捞记录数据");try{const _=await Re.get("http://localhost:8080/catch");return y.value=_.data,console.log(`获取到${y.value.length}条捕捞记录`),ae.value.catches=!0,Promise.resolve()}catch(_){return console.error("获取捕捞记录数据失败:",_),Promise.reject(_)}finally{ce.value=!1}},g=P(()=>{let _=[...j.value];if(ee.value){const a=ee.value.toLowerCase();_=_.filter(n=>n.ship_id&&n.ship_id.toLowerCase().includes(a)||n.ship_name&&n.ship_name.toLowerCase().includes(a)||n.ship_master&&n.ship_master.toLowerCase().includes(a)||n.ship_type&&n.ship_type.toLowerCase().includes(a)||n.ship_company&&n.ship_company.toLowerCase().includes(a)||n.ship_power&&n.ship_power.toLowerCase().includes(a)||n.ship_material&&n.ship_material.toLowerCase().includes(a)||n.ship_equip&&n.ship_equip.toLowerCase().includes(a))}return se.value&&(_=_.filter(a=>a.ship_company===se.value)),_}),N=P(()=>{const _=(me.value-1)*ve.value,a=_+ve.value;return g.value.slice(_,a)}),I=P(()=>{let _=[...y.value];if(E.value){const a=E.value.toLowerCase();_=_.filter(n=>n.catch_fishery&&n.catch_fishery.toLowerCase().includes(a)||n.catch_ship&&n.catch_ship.toLowerCase().includes(a)||n.catch_dock&&n.catch_dock.toLowerCase().includes(a)||n.catch_company&&n.catch_company.toLowerCase().includes(a)||n.catch_type&&n.catch_type.toLowerCase().includes(a)||n.catch_name&&n.catch_name.toLowerCase().includes(a))}return U.value&&(_=_.filter(a=>a.catch_year==U.value),M.value&&(_=_.filter(a=>a.catch_month==M.value),J.value&&(_=_.filter(a=>a.catch_day==J.value)))),_}),pe=P(()=>{const _=(A.value-1)*_e.value,a=_+_e.value;return I.value.slice(_,a)}),z=()=>{me.value=1},K=()=>{ee.value="",me.value=1},we=()=>{me.value=1},re=()=>{A.value=1},ta=()=>{E.value="",A.value=1},Ge=()=>{M.value="",J.value="",A.value=1},Me=()=>{J.value="",A.value=1},Xe=()=>{A.value=1},oa=()=>{C.value="",D.value="",la()},je=()=>{D.value="",la()};Qe(oe,_=>{console.log("切换到标签页:",_),_==="analysis"&&!be.value&&Ke(()=>{$()})});const $=()=>{if(be.value){console.log("图表已初始化，跳过");return}console.log("初始化图表...");const _=xe.value,a=ye.value,n=$e.value;if(!_||!a||!n){console.error("图表容器未找到，将在下次DOM更新后重试");return}R&&R.dispose(),W&&W.dispose(),X&&X.dispose(),R=Be(_),W=Be(a),X=Be(n);const s=()=>{R&&R.resize(),W&&W.resize(),X&&X.resize()};window.addEventListener("resize",s),be.value=!0,console.log("图表初始化完成"),la()},la=()=>{!R||!W||!X||(console.log("更新图表数据..."),na(),sa())},na=()=>{if(!R||!W)return;let _=[...y.value];m.value&&(_=_.filter(r=>r.catch_year==m.value),C.value&&(_=_.filter(r=>r.catch_month==C.value),D.value&&(_=_.filter(r=>r.catch_day==D.value))));let a="year",n=[];if(m.value&&!C.value)a="month",n=Array.from({length:12},(r,k)=>k+1);else if(m.value&&C.value&&!D.value){a="day";const r=new Date(m.value,C.value,0).getDate();n=Array.from({length:r},(k,c)=>c+1)}else m.value&&C.value&&D.value?(a="hour",n=Array.from({length:24},(r,k)=>k)):(a="year",n=[...new Set(y.value.map(r=>r.catch_year))].sort());const s=[],F=L.value.map(r=>{const c=_.filter(d=>d.catch_company===r).reduce((d,f)=>d+Number(f.catch_weight||0),0);return{name:r,value:parseFloat(c.toFixed(2))}}).filter(r=>r.value>0);L.value.forEach(r=>{const k=[];for(const c of n){let d=_.filter(x=>x.catch_company===r);a==="month"?d=d.filter(x=>x.catch_month==c):a==="day"?d=d.filter(x=>x.catch_day==c):a==="hour"?d=d.filter(x=>x.catch_hour==c):a==="year"&&(d=d.filter(x=>x.catch_year==c));const f=d.reduce((x,ie)=>x+Number(ie.catch_weight||0),0);k.push(parseFloat(f.toFixed(2)))}s.push({name:r,type:"bar",barWidth:14,barGap:"10%",emphasis:{focus:"series"},data:k})});const B=n.map(r=>a==="month"?`${r}月`:a==="day"?`${r}日`:a==="hour"?`${r}时`:`${r}年`),T=["#5470C6","#91CC75","#EE6666","#FAC858","#73C0DE","#3BA272","#FC8452","#9A60B4","#ea7ccc","#4EC5D5"];let he="";m.value?(he=`${m.value}年`,C.value&&(he+=`${C.value}月`,D.value&&(he+=`${D.value}日`))):he="全部时间";const Q={color:T,title:{text:`${he}公司捕捞量统计`,left:"center",textStyle:{fontSize:18,fontWeight:"bold"}},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{data:L.value,top:"40px"},grid:{left:"3%",right:"4%",bottom:"10%",top:"80px",containLabel:!0},xAxis:{type:"category",data:B,axisLabel:{interval:0,rotate:B.length>12?45:0,fontSize:12}},yAxis:{type:"value",name:"捕捞量(公斤)",nameTextStyle:{fontSize:14,padding:[0,0,0,40]}},series:s},p={color:T,title:{text:`${he}公司捕捞量比例`,left:"center",textStyle:{fontSize:18,fontWeight:"bold"}},tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} 公斤 ({d}%)"},legend:{orient:"vertical",left:"left",top:"middle",data:F.map(r=>r.name)},series:[{name:"公司捕捞量",type:"pie",radius:["40%","70%"],center:["60%","50%"],avoidLabelOverlap:!1,itemStyle:{borderRadius:10,borderColor:"#fff",borderWidth:2},label:{show:!0,formatter:"{b}: {c} 公斤"},emphasis:{label:{show:!0,fontSize:16,fontWeight:"bold"},itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}},data:F.length>0?F:[{name:"暂无数据",value:1}]}]};R.setOption(Q,!0),W.setOption(p,!0)},sa=()=>{if(!X)return;let _=[...y.value];m.value&&(_=_.filter(Q=>Q.catch_year==m.value),C.value&&(_=_.filter(Q=>Q.catch_month==C.value),D.value&&(_=_.filter(Q=>Q.catch_day==D.value))));let a=[],n=_;ke.value&&(n=_.filter(Q=>Q.catch_company===ke.value)),a=[...new Set(n.map(Q=>Q.catch_type))].map(Q=>{const r=n.filter(k=>k.catch_type===Q).reduce((k,c)=>k+Number(c.catch_weight||0),0);return{name:Q,value:parseFloat(r.toFixed(2))}}).filter(Q=>Q.value>0);const F=["#5470C6","#91CC75","#EE6666","#FAC858","#73C0DE","#3BA272","#FC8452","#9A60B4","#ea7ccc","#4EC5D5"];let B="";m.value?(B=`${m.value}年`,C.value&&(B+=`${C.value}月`,D.value&&(B+=`${D.value}日`))):B="全部时间";const T=ke.value?`${B} ${ke.value} 海产品捕捞比例`:`${B}所有公司海产品捕捞比例`,he={color:F,title:{text:T,left:"center",textStyle:{fontSize:18,fontWeight:"bold"}},tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} 公斤 ({d}%)"},legend:{orient:"vertical",left:"left",top:"middle",data:a.map(Q=>Q.name)},series:[{name:"海产品捕捞量",type:"pie",radius:["40%","70%"],center:["60%","50%"],avoidLabelOverlap:!1,itemStyle:{borderRadius:10,borderColor:"#fff",borderWidth:2},label:{show:!0,formatter:"{b}: {c} 公斤"},emphasis:{label:{show:!0,fontSize:16,fontWeight:"bold"},itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}},data:a.length>0?a:[{name:"暂无数据",value:1}]}]};X.setOption(he,!0)};Sa(()=>{R&&(R.dispose(),R=null),W&&(W.dispose(),W=null),X&&(X.dispose(),X=null),window.removeEventListener("resize",da)});const da=()=>{R&&G.value&&R.resize(),W&&G.value&&W.resize(),X&&G.value&&X.resize()};return(_,a)=>{const n=Da,s=Va,F=Ua,B=La,T=za,he=$a,Q=Pa,p=ga,r=ma,k=_a,c=Fa;return v(),V(k,{modelValue:G.value,"onUpdate:modelValue":a[15]||(a[15]=d=>G.value=d),title:"渔船管理中心",direction:"ltr",size:"90%","with-header":!0,"before-close":Fe,"destroy-on-close":!1,"size-drag":!0,class:"ship-drawer"},{default:u(()=>[h("div",il,[h("div",dl,[a[17]||(a[17]=h("h2",null,"渔船数据分析中心",-1)),e(n,{onClick:Ce,type:"primary",size:"small"},{default:u(()=>a[16]||(a[16]=[De("返回主页")])),_:1})]),e(r,{modelValue:oe.value,"onUpdate:modelValue":a[14]||(a[14]=d=>oe.value=d),type:"card"},{default:u(()=>[e(p,{label:"渔船详情",name:"info"},{default:u(()=>[h("div",cl,[e(s,{modelValue:ee.value,"onUpdate:modelValue":a[0]||(a[0]=d=>ee.value=d),placeholder:"输入关键词查询渔船信息",clearable:"",style:{width:"300px","margin-right":"15px"},onClear:K,onKeyup:ca(z,["enter"])},null,8,["modelValue"]),e(B,{modelValue:se.value,"onUpdate:modelValue":a[1]||(a[1]=d=>se.value=d),placeholder:"选择所属公司",clearable:"",style:{width:"250px"},onChange:we},{default:u(()=>[(v(!0),O(q,null,H(L.value,d=>(v(),V(F,{key:d,label:d,value:d},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),aa((v(),V(he,{data:N.value,border:"",style:{width:"100%"},height:"500"},{default:u(()=>[e(T,{prop:"ship_id",label:"渔船编号",width:"120"}),e(T,{prop:"ship_name",label:"渔船名称",width:"150"}),e(T,{prop:"ship_master",label:"船长",width:"100"}),e(T,{prop:"ship_type",label:"渔船类型",width:"150"}),e(T,{prop:"ship_company",label:"所属公司",width:"200"}),e(T,{prop:"ship_power",label:"动力类型",width:"120"}),e(T,{prop:"ship_material",label:"船体材质",width:"120"}),e(T,{prop:"ship_length",label:"船长(米)",width:"100"}),e(T,{prop:"ship_load",label:"载重(吨)",width:"100"}),e(T,{prop:"ship_tonage",label:"吨位(吨)",width:"100"}),e(T,{prop:"ship_range",label:"航程(海里)",width:"120"}),e(T,{prop:"ship_equip",label:"设备配置"}),e(T,{prop:"ship_tel",label:"联系电话",width:"150"})]),_:1},8,["data"])),[[c,Y.value]]),e(Q,{"current-page":me.value,"page-size":ve.value,total:g.value.length,layout:"total, sizes, prev, pager, next, jumper","page-sizes":[10,20,50,100],"onUpdate:currentPage":a[2]||(a[2]=d=>me.value=d),"onUpdate:pageSize":a[3]||(a[3]=d=>ve.value=d)},null,8,["current-page","page-size","total"])]),_:1}),e(p,{label:"捕捞记录",name:"records"},{default:u(()=>[h("div",pl,[e(s,{modelValue:E.value,"onUpdate:modelValue":a[4]||(a[4]=d=>E.value=d),placeholder:"输入关键词查询捕捞记录",clearable:"",style:{width:"300px","margin-right":"15px"},onClear:ta,onKeyup:ca(re,["enter"])},null,8,["modelValue"]),e(B,{modelValue:U.value,"onUpdate:modelValue":a[5]||(a[5]=d=>U.value=d),placeholder:"选择年份",clearable:"",style:{width:"150px","margin-right":"15px"},onChange:Ge},{default:u(()=>[(v(!0),O(q,null,H(Se.value,d=>(v(),V(F,{key:d,label:`${d}年`,value:d},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e(B,{modelValue:M.value,"onUpdate:modelValue":a[6]||(a[6]=d=>M.value=d),placeholder:"选择月份",clearable:"",disabled:!U.value,style:{width:"150px","margin-right":"15px"},onChange:Me},{default:u(()=>[(v(!0),O(q,null,H(Le.value,d=>(v(),V(F,{key:d,label:`${d}月`,value:d},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"]),e(B,{modelValue:J.value,"onUpdate:modelValue":a[7]||(a[7]=d=>J.value=d),placeholder:"选择日期",clearable:"",disabled:!M.value,style:{width:"150px"},onChange:Xe},{default:u(()=>[(v(!0),O(q,null,H(ue.value,d=>(v(),V(F,{key:d,label:`${d}日`,value:d},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),aa((v(),V(he,{data:pe.value,border:"",style:{width:"100%"},height:"500"},{default:u(()=>[e(T,{prop:"catch_fishery",label:"渔场",width:"120"}),e(T,{prop:"catch_ship",label:"渔船编号",width:"120"}),e(T,{prop:"catch_dock",label:"停靠码头",width:"150"}),e(T,{prop:"catch_company",label:"所属公司",width:"200"}),e(T,{prop:"catch_year",label:"年",width:"80"}),e(T,{prop:"catch_month",label:"月",width:"80"}),e(T,{prop:"catch_day",label:"日",width:"80"}),e(T,{prop:"catch_hour",label:"时",width:"80"}),e(T,{prop:"catch_type",label:"海产类别",width:"120"}),e(T,{prop:"catch_name",label:"海产名称",width:"120"}),e(T,{prop:"catch_weight",label:"重量(公斤)",width:"120"}),e(T,{prop:"catch_date",label:"捕捞日期",width:"120"}),e(T,{prop:"catch_time",label:"捕捞时间",width:"140"})]),_:1},8,["data"])),[[c,ce.value]]),e(Q,{"current-page":A.value,"page-size":_e.value,total:I.value.length,layout:"total, sizes, prev, pager, next, jumper","page-sizes":[10,20,50,100],"onUpdate:currentPage":a[8]||(a[8]=d=>A.value=d),"onUpdate:pageSize":a[9]||(a[9]=d=>_e.value=d)},null,8,["current-page","page-size","total"])]),_:1}),e(p,{label:"捕捞分析",name:"analysis"},{default:u(()=>[h("div",vl,[e(B,{modelValue:m.value,"onUpdate:modelValue":a[10]||(a[10]=d=>m.value=d),placeholder:"选择年份",clearable:"",style:{width:"150px","margin-right":"15px"},onChange:oa},{default:u(()=>[(v(!0),O(q,null,H(Oe.value,d=>(v(),V(F,{key:d,label:`${d}年`,value:d},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e(B,{modelValue:C.value,"onUpdate:modelValue":a[11]||(a[11]=d=>C.value=d),placeholder:"选择月份",clearable:"",disabled:!m.value,style:{width:"150px","margin-right":"15px"},onChange:je},{default:u(()=>[(v(!0),O(q,null,H(Ye.value,d=>(v(),V(F,{key:d,label:`${d}月`,value:d},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"]),e(B,{modelValue:D.value,"onUpdate:modelValue":a[12]||(a[12]=d=>D.value=d),placeholder:"选择日期",clearable:"",disabled:!C.value,style:{width:"150px","margin-right":"15px"},onChange:la},{default:u(()=>[(v(!0),O(q,null,H(Pe.value,d=>(v(),V(F,{key:d,label:`${d}日`,value:d},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"]),e(B,{modelValue:ke.value,"onUpdate:modelValue":a[13]||(a[13]=d=>ke.value=d),placeholder:"选择公司(海产品饼图)",clearable:"",style:{width:"250px"},onChange:sa},{default:u(()=>[(v(!0),O(q,null,H(L.value,d=>(v(),V(F,{key:d,label:d,value:d},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),h("div",hl,[h("div",fl,[a[18]||(a[18]=h("div",{class:"chart-title"},"公司捕捞量统计",-1)),h("div",{ref_key:"companyBarChart",ref:xe,style:{width:"140vh",height:"500px"}},null,512)]),h("div",_l,[h("div",ml,[a[19]||(a[19]=h("div",{class:"chart-title"},"公司捕捞量比例",-1)),h("div",{ref_key:"companyPieChart",ref:ye,style:{width:"100%",height:"400px"}},null,512)]),h("div",gl,[a[20]||(a[20]=h("div",{class:"chart-title"},"海产品捕捞量比例",-1)),h("div",{ref_key:"productPieChart",ref:$e,style:{width:"100%",height:"400px"}},null,512)])])])]),_:1})]),_:1},8,["modelValue"])])]),_:1},8,["modelValue"])}}},uo=pa(yl,[["__scopeId","data-v-ab045c03"]]),bl={class:"message-list"},wl={class:"message-card-content"},Cl={class:"message-info"},kl={class:"message-title"},xl={class:"message-preview"},Sl={class:"message-meta"},Vl={class:"sender"},Dl={class:"time"},$l={__name:"MessageList",props:{messages:{type:Array,default:()=>[]}},emits:["item-click"],setup(We){return(Ne,Ae)=>{const ze=ja,G=dt,Ce=ct,Fe=Ya;return v(),O("div",bl,[(v(!0),O(q,null,H(We.messages,L=>(v(),V(Ce,{key:L.id,shadow:"hover",class:"message-card",onClick:oe=>Ne.$emit("item-click",L)},{default:u(()=>[h("div",wl,[e(ze,{src:L.avatar,size:50},null,8,["src"]),h("div",Cl,[h("div",kl,[h("span",null,Ve(L.title),1),L.unread?(v(),V(G,{key:0,type:"danger",size:"small"},{default:u(()=>[De(Ve(L.unread),1)]),_:2},1024)):ka("",!0)]),h("div",xl,Ve(L.content),1),h("div",Sl,[h("span",Vl,Ve(L.sender),1),h("span",Dl,Ve(L.time),1)])])])]),_:2},1032,["onClick"]))),128)),We.messages.length===0?(v(),V(Fe,{key:0,description:"暂无消息"})):ka("",!0)])}}},ia=pa($l,[["__scopeId","data-v-a8b10311"]]),zl={class:"drawer-content"},Fl={class:"header"},Pl={class:"message-container"},Ll={key:0,class:"chat-room-container"},Ul={class:"chat-room-header"},Al={class:"message-avatar"},Tl={class:"message-body"},Ol={class:"message-info"},El={class:"sender"},Ml={class:"time"},Il=["innerHTML"],Bl={class:"message-editor"},Rl={class:"editor-toolbar"},Wl={__name:"MessCenter",props:{modelValue:Boolean},emits:["update:modelValue"],setup(We,{emit:Ne}){const Ae=We,ze=Ne,G=P({get(){return Ae.modelValue},set(y){ze("update:modelValue",y)}}),Ce=()=>{G.value=!1},Fe=t("important"),L=t([{id:1,title:"系统维护通知",content:"今晚22:00-24:00系统将进行维护升级",sender:"系统管理员",time:"2023-05-10 09:30",unread:3,avatar:"https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png"}]),oe=t([{id:2,title:"月度经营会议",content:"请各部门负责人准备5月份经营分析报告",sender:"总经理办公室",time:"2023-05-09 14:20",unread:0,avatar:"https://cube.elemecdn.com/0/88/03b0d39583f48206768a7534e55bcpng.png"}]),te=t([]),ae=t([]),ee=t([]),se=t([]),me=t([]),ve=t([]),Y=t(null),j=t(""),E=t(null),U=y=>{Y.value={id:y.id,title:y.title,messages:[{id:1,sender:y.sender,content:y.content,time:y.time,avatar:y.avatar,isMe:!1},{id:2,sender:"我",content:"收到，我们会按时准备",time:"2023-05-10 10:15",avatar:"https://cube.elemecdn.com/9/c2/f0ee8a3c7c9638a54940382568c9dpng.png",isMe:!0}]},y.unread=0},M=()=>{Y.value=null},J=()=>{if(!j.value.trim())return;const y=new Date,m=`${y.getHours()}:${y.getMinutes().toString().padStart(2,"0")}`;Y.value.messages.push({id:Date.now(),sender:"我",content:j.value,time:m,avatar:"https://cube.elemecdn.com/9/c2/f0ee8a3c7c9638a54940382568c9dpng.png",isMe:!0}),j.value="",Ke(()=>{E.value.scrollTop=E.value.scrollHeight})},A=()=>{j.value+="😊"},_e=()=>{j.value+="[图片]"},ce=()=>{j.value+="[文件]"};return xa(()=>{}),(y,m)=>{const C=Da,D=ga,ke=ma,xe=ja,ye=Va,$e=pt,R=_a;return v(),V(R,{modelValue:G.value,"onUpdate:modelValue":m[2]||(m[2]=W=>G.value=W),title:"消息中心",direction:"rtl",size:"50%","with-header":!0,"destroy-on-close":"",class:"message-center-drawer"},{default:u(()=>[h("div",zl,[h("div",Fl,[m[4]||(m[4]=h("h2",null,"企业消息中心",-1)),e(C,{onClick:Ce,type:"primary",size:"small"},{default:u(()=>m[3]||(m[3]=[De("返回主页")])),_:1})]),h("div",Pl,[e(ke,{modelValue:Fe.value,"onUpdate:modelValue":m[0]||(m[0]=W=>Fe.value=W),type:"card",class:"message-tabs"},{default:u(()=>[e(D,{label:"重要置顶",name:"important"},{default:u(()=>[e(ia,{messages:L.value,onItemClick:U},null,8,["messages"])]),_:1}),e(D,{label:"总部消息",name:"headquarters"},{default:u(()=>[e(ia,{messages:oe.value,onItemClick:U},null,8,["messages"])]),_:1}),e(D,{label:"车队消息",name:"fleet"},{default:u(()=>[e(ia,{messages:te.value,onItemClick:U},null,8,["messages"])]),_:1}),e(D,{label:"码头消息",name:"dock"},{default:u(()=>[e(ia,{messages:ae.value,onItemClick:U},null,8,["messages"])]),_:1}),e(D,{label:"渔船消息",name:"ship"},{default:u(()=>[e(ia,{messages:ee.value,onItemClick:U},null,8,["messages"])]),_:1}),e(D,{label:"渔场消息",name:"fishery"},{default:u(()=>[e(ia,{messages:se.value,onItemClick:U},null,8,["messages"])]),_:1}),e(D,{label:"生产车间",name:"workshop"},{default:u(()=>[e(ia,{messages:me.value,onItemClick:U},null,8,["messages"])]),_:1}),e(D,{label:"其他消息",name:"others"},{default:u(()=>[e(ia,{messages:ve.value,onItemClick:U},null,8,["messages"])]),_:1})]),_:1},8,["modelValue"]),Y.value?(v(),O("div",Ll,[h("div",Ul,[h("h3",null,Ve(Y.value.title),1),e(C,{onClick:M,type:"text",icon:"el-icon-close"})]),h("div",{class:"chat-messages",ref_key:"chatMessages",ref:E},[(v(!0),O(q,null,H(Y.value.messages,(W,X)=>(v(),O("div",{key:X,class:"message-item"},[h("div",{class:Na(["message-content",{"is-me":W.isMe}])},[h("div",Al,[e(xe,{src:W.avatar,size:40},null,8,["src"])]),h("div",Tl,[h("div",Ol,[h("span",El,Ve(W.sender),1),h("span",Ml,Ve(W.time),1)]),h("div",{class:"message-text",innerHTML:W.content},null,8,Il)])],2)]))),128))],512),h("div",Bl,[e(ye,{modelValue:j.value,"onUpdate:modelValue":m[1]||(m[1]=W=>j.value=W),type:"textarea",rows:3,placeholder:"输入消息内容...",resize:"none"},null,8,["modelValue"]),h("div",Rl,[e($e,null,{default:u(()=>[e(C,{size:"small",onClick:A},{default:u(()=>m[5]||(m[5]=[De("😊")])),_:1}),e(C,{size:"small",onClick:_e},{default:u(()=>m[6]||(m[6]=[De("图片")])),_:1}),e(C,{size:"small",onClick:ce},{default:u(()=>m[7]||(m[7]=[De("文件")])),_:1})]),_:1}),e(C,{type:"primary",size:"small",onClick:J},{default:u(()=>m[8]||(m[8]=[De("发送")])),_:1})])])])):ka("",!0)])])]),_:1},8,["modelValue"])}}},io=pa(Wl,[["__scopeId","data-v-f0f0818f"]]);export{oo as D,ro as a,no as b,so as c,uo as d,io as e};
